<!-- users/add.html -->
{% extends 'base.html' %}

{% block content %}



<div>
    <div class="border-b border-gray-200 bg-gray-50 p-4 dark:border-gray-800 dark:bg-gray-950 sm:p-6 lg:p-8">
        <header>
            <div class="flex flex-col gap-2 text-center sm:flex-row sm:items-center sm:justify-between sm:text-start">
                <div class="grow">
                    <h1 id="title" class="mb-1 text-xl font-bold">Import cPanel Account</h1>
                    <h2 id="subtitle" class="text-sm font-medium text-slate-500">Create new OpenPanel user account from cPanel backup file.</h2>
                </div>
                <div class="flex flex-none items-center justify-center gap-2 rounded-sm px-2 sm:justify-end sm:bg-transparent sm:px-0">
<a href="/import/cpanel" class="relative inline-flex items-center justify-center rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out cursor-pointer outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit border-black bg-black text-white hover:bg-gray-800 sm:mt-0">View Logs</a>
                </div>
            </div>
    </header>
    </div>


<div id="collapseAddNewUser">
    <div id="create_user_form" class="sm:mx-auto sm:max-w-2xl" style="display:block;">
            <form id="userimportForm" class="mt-8" method="POST" action="/import/cpanel">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">





<div x-data="backupSelector()" class="relative w-full mt-2 grid gap-2">
    <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">Backup file</p>

    <input
        type="text"
        x-model="selectedFile"
        @click="fetchBackups"
        @focus="dropdownOpen = true"
        placeholder="Select a backup file"
        class="mt-4 relative block w-full appearance-none truncate rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 focus:ring-2 focus:ring-indigo-200 focus:dark:ring-indigo-700/30 focus:border-indigo-500 focus:dark:border-indigo-700 [&::--webkit-search-cancel-button]:hidden [&::-webkit-search-cancel-button]:hidden [&::-webkit-search-decoration]:hidden"
        required
        name="path"
        id="path"
    >

    <!-- Dropdown -->
    <div
        x-show="dropdownOpen && backups.length > 0"
        @click.outside="dropdownOpen = false"
        class="absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded shadow-lg max-h-60 overflow-y-auto"
    >
        <template x-for="file in backups" :key="file">
            <div
                @click="selectFile(file)"
                class="bg-white dark:bg-[#090E1A] px-4 py-2 hover:bg-gray-100 hover:dark:bg-gray-500 cursor-pointer"
                x-text="file"
            ></div>
        </template>
    </div>
</div>



            <div class="mx-auto my-6 flex w-full items-center justify-between gap-3 text-sm text-gray-500 dark:text-gray-500"><div class="h-[1px] w-full bg-gray-200 dark:bg-gray-800"></div></div>


<div class="col-span-full">
    <div role="radiogroup" aria-required="false" dir="ltr" class="grid gap-2" tremor-id="tremor-raw" tabindex="0" style="outline: none;">
        <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">Select a package</p>

        <!-- Alpine.js state defined outside the loop -->
        <div x-data="{ selectedPlan: '{{ plans[0].name }}' }" class="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-3">
            {% for plan in plans %}
            <button
                type="button"
                role="radio"
                :aria-checked="selectedPlan === '{{ plan.name }}' ? 'true' : 'false'"
                :data-state="selectedPlan === '{{ plan.name }}' ? 'checked' : ''"
                class="group relative w-full rounded-md border p-4 text-left shadow-sm transition focus:outline-none bg-white dark:bg-gray-950 border-gray-300 dark:border-gray-800 data-[state=checked]:border-blue-500 data-[state=checked]:dark:border-blue-500"
                @click="selectedPlan = '{{ plan.name }}'"
                id="{{ plan.id }}"
            >
                <div class="flex w-full flex-col justify-between">
                    <div>
                        <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="{{ plan.id }}" aria-describedby="{{ plan.id }}-description">
                            {{ plan.name }}
                        </label>
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-500">{{ plan.description }}</p>
                    </div>

                    <!-- Show/hide limits with local state -->
                    <div class="mt-4" x-data="{ showDetails: false }">
                        <span @click="showDetails = !showDetails" class="text-sm font-medium text-gray-900 dark:text-gray-50 cursor-pointer">Display Limits</span>
                        <div x-show="showDetails">
<p class="mt-6 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.cpu == 0 or plan.cpu == '0' else plan.cpu }} Cores
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.ram|lower == '0g' or plan.ram == 0 else plan.ram }} Memory
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.disk_limit == '0 GB' else plan.disk_limit }} Storage
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.inodes_limit == 0 else plan.inodes_limit }} Inodes
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.bandwidth == 0 else plan.bandwidth }} Mbps
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.domains_limit == 0 else plan.domains_limit }} Domains
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.websites_limit == 0 else plan.websites_limit }} Websites
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.email_limit == 0 else plan.email_limit }} Email accounts
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.ftp_limit == 0 else plan.ftp_limit }} FTP accounts
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.db_limit == 0 else plan.db_limit }} MySQL Databases
</p>

                        </div>
                    </div>
                </div>

                <div class="hidden relative flex size-4 shrink-0 appearance-none items-center justify-center rounded-full border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950">
                    <template x-if="selectedPlan === '{{ plan.name }}'">
                        <div class="size-1.5 shrink-0 rounded-full bg-white"></div>
                    </template>
                </div>
            </button>

            <input
                type="radio"
                value="{{ plan.name }}"
                name="plan_name"
                :checked="selectedPlan === '{{ plan.name }}'"
                style="display: none;"
            />
            {% endfor %}
        </div>
    </div>
</div>




            <div class="mx-auto my-6 flex w-full items-center justify-between gap-3 text-sm text-gray-500 dark:text-gray-500"><div class="h-[1px] w-full bg-gray-200 dark:bg-gray-800"></div></div>



            <div class="flex items-center justify-end space-x-4">
                <a href="/users" class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600">Go back</a>

<div id="tooltip-community-limit-reached" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">
    OpenPanel Community edition has a limit of 3 user accounts. Remove account or upgrade to Enterprise
    <div class="tooltip-arrow" data-popper-arrow></div>
</div>

<div id="tooltip-demo" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">
    This action is disabled in demo mode.
    <div class="tooltip-arrow" data-popper-arrow></div>
</div>

                <button id="ImportUserButton" type="submit" class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-transparent text-white dark:text-white bg-blue-500 dark:bg-blue-500 hover:bg-blue-600 dark:hover:bg-blue-600 disabled:bg-blue-300 disabled:text-white disabled:dark:bg-blue-800 disabled:dark:text-blue-400" id="CreateUserButton" {% if users | length >= 3 and license_type == "Community" %}data-tooltip-target="tooltip-community-limit-reached"{% endif %}>Import from Backup</button>
            </div>
        </form>
    </div>
</div>


</div>





<script>
function backupSelector() {
    return {
        backups: [],
        selectedFile: '',
        dropdownOpen: false,
        fetchBackups() {
            fetch('/json/cpanel-backups')
                .then(response => response.json())
                .then(data => {
                    this.backups = data;
                    this.dropdownOpen = true;
                })
                .catch(err => {
                    console.error('Error fetching backup files:', err);
                    this.backups = [];
                    this.dropdownOpen = false;
                });
        },
        selectFile(file) {
            this.selectedFile = file;
            this.dropdownOpen = false;
        }
    }
}
</script>

  
{% endblock %}
