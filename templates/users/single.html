<!-- single_user.html -->
{% extends 'base.html' %}

{% block content %}





{% if user %}


<div x-data="{
    activeTab: 'stats',
    diskInfo: [],
    containers: [],
    images: [],
    volumes: [],
    loading: false,
    error: null,
    diskLoaded: false,

    loadDiskUsage() {
        if (this.diskLoaded) return;
        this.diskLoaded = true;
        this.loading = true;
        this.error = null;

        fetch(`/client/disk/{{ user.username }}`)
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    this.error = data.error;
                    this.containers = [];
                    this.images = [];
                    this.volumes = [];
                } else {
                    const payload = data[0] || {};
                    this.containers = payload.Containers || [];
                    this.images = payload.Images || [];
                    this.volumes = payload.Volumes || [];
                }
            })
            .catch(err => {
                this.error = 'Failed to load disk info';
                console.error(err);
            })
            .finally(() => {
                this.loading = false;
            });
    }
}">


    <div class="border-b border-gray-200 bg-gray-50 p-4 dark:border-gray-800 dark:bg-gray-950 sm:p-6 lg:p-8">
        <header>
            <div class="flex flex-col gap-2 text-center sm:flex-row sm:items-center sm:justify-between sm:text-start">
                <div class="grow">
                    <h1 class="mb-1 text-xl font-bold">{{ user.username.split('_')[-1] }} {% if "SUSPENDED_" in user.username %} <span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-red-50 text-red-700 ring-red-500/30 dark:bg-red-400/10 dark:text-red-300 dark:ring-red-400/20 ml-1">Suspended</span>{% endif %}
</h1>
                    <h2 class="text-sm font-medium text-slate-500">
                       <span class="inline-flex">
<!-- IP --> 
{% if country_code %}<img class="w-4 h-4 rounded mr-1" src="/static/dist/img/flags/{{country_code.lower()}}.svg" alt="IP address location: {{country_code}}"></img></span><span>{{server_ip}} / {% endif %} 
<!-- CPU -->
{% if env_data.TOTAL_CPU == 0 or env_data.TOTAL_CPU == '0' %}∞{% else %}{{env_data.TOTAL_CPU}}{% endif %} Cores /
<!-- RAM -->
{% if env_data.TOTAL_RAM == 0 or env_data.TOTAL_RAM == '0g' %}∞{% else %}{{env_data.TOTAL_RAM[:-1]}} GB{% endif %} Memory /
<!-- DISK -->
{% if disk.disk_hard != 0 %}{{ (disk.disk_hard / 1024000) | round(2) }}<!---->GB{% else %}∞{% endif %} Disk</span>

                    </h2>
               </div> 
                <div class="flex flex-none items-center justify-center gap-2 rounded-sm px-2 sm:justify-end sm:bg-transparent sm:px-0">

                    {% if "SUSPENDED_" in user.username %}
                    {% else %}

<div id="tooltip-user-autologin" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">
    Login as {{ user.username.split('_')[-1] }} into OpenPanel
    <div class="tooltip-arrow" data-popper-arrow></div>
</div>

<a href="/login/token?username={{ user.username.split('_')[-1] }}" 
   target="_blank" 
   data-tooltip-target="tooltip-user-autologin" data-tooltip-placement="left"
   class="relative inline-flex items-center justify-center rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out cursor-pointer outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit border-black bg-black text-white hover:bg-gray-800 sm:mt-0"
   x-data="{ spinning: false }"
   @click="spinning = true; setTimeout(() => spinning = false, 500)">
    
    <svg version="1.0" 
         style="vertical-align:middle; margin-right:5px;" 
         xmlns="http://www.w3.org/2000/svg" 
         width="24" height="24" 
         viewBox="0 0 213.000000 215.000000" 
         preserveAspectRatio="xMidYMid meet" 
         :class="{'animate-spin': spinning}">
        <g transform="translate(0.000000,215.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
            <path d="M990 2071 c-39 -13 -141 -66 -248 -129 -53 -32 -176 -103 -272 -158 -206 -117 -276 -177 -306 -264 -17 -50 -19 -88 -19 -460 0 -476 0 -474 94 -568 55 -56 124 -98 604 -369 169 -95 256 -104 384 -37 104 54 532 303 608 353 76 50 126 113 147 184 8 30 12 160 12 447 0 395 -1 406 -22 461 -34 85 -98 138 -317 264 -104 59 -237 136 -295 170 -153 90 -194 107 -275 111 -38 2 -81 0 -95 -5z m205 -561 c66 -38 166 -95 223 -127 l102 -58 0 -262 c0 -262 0 -263 -22 -276 -13 -8 -52 -31 -88 -51 -36 -21 -126 -72 -200 -115 l-135 -78 -3 261 -3 261 -166 95 c-91 52 -190 109 -219 125 -30 17 -52 34 -51 39 3 9 424 256 437 255 3 0 59 -31 125 -69z"></path>
        </g>
    </svg> 
    OpenPanel
</a>








                    {% endif %}

                </div>
            </div>

    </header>
    </div>




<nav class="flex sm:hidden justify-center w-full" aria-label="Actions" data-orientation="horizontal" dir="ltr">
    <div style="position: relative;">
        <ul data-orientation="horizontal" class="flex items-center justify-start whitespace-nowrap border-b [scrollbar-width:none] [&amp;::-webkit-scrollbar]:hidden border-gray-200 dark:border-gray-800" dir="ltr">
            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="activeTab = 'stats'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'stats'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Statistics</span>
                </a>
            </li>
            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="activeTab = 'services'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'services'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Services</span>
                </a>
            </li>
            <li class="">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="activeTab = 'storage'; loadDiskUsage()"  :class="{'text-blue-600 dark:text-blue-500': activeTab === 'storage'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Storage</span>
                </a>
            </li>
            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="activeTab = 'info'; fetchCustomMessage()" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'info'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Account</span>
                </a>
            </li>

            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="$store.activityStore.fetchLogs(); activeTab = 'activity'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'info'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Activity</span>
                </a>
            </li>

{% if "SUSPENDED_" in user.username %} 
            <li class="flex cursor-pointer">

<form method="POST" action="/user/unsuspend/{{ user.username.split('_')[-1] }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button class="" type="submit"><span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Unsuspend</span></button>
</form>

            </li>
{% else %}
            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="$store.ipStore.fetchIPs(); activeTab = 'edit'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'edit'}" >
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Edit</span>
                </a>
            </li>

            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="activeTab = 'suspend'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'suspend'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Suspend</span>
                </a>
            </li>
{% endif %}                


            <li class="flex cursor-pointer">
                <a class="group relative flex shrink-0 select-none items-center justify-center" @click="activeTab = 'delete'" :class="{'text-red-600 dark:text-red-500': activeTab === 'delete'}">
                    <span class="-mb-px flex items-center justify-center whitespace-nowrap border-b-2 border-transparent p-3 text-sm font-medium transition-all text-gray-500 dark:text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-400 group-hover:border-gray-300 dark:group-hover:border-gray-400 group-data-active:border-blue-500 group-data-active:text-blue-500 dark:group-data-active:border-blue-500 dark:group-data-active:text-blue-500 outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">Delete</span>
                </a>
            </li>
        </ul>
    </div>
</nav>



<div 
  class="relative w-full p-6 text-left border-b bg-white dark:bg-[#090E1A] border-gray-200 dark:border-gray-900 !p-0"
  x-data="customMessageComponent('{{ user.username }}')"
  x-init="initTabs()"
>

<script>
function customMessageComponent(username) {
    return {
        containerName: username.split('_').pop(),
        activeTab: '',
        fetchCustomMessage() {
            $.ajax({
                url: `/get_custom_message_for_user/${this.containerName}`,
                type: 'GET',
                success: (response) => {
                    if (response.custom_message) {
                        $('#custom_message_for_this_user').val(response.custom_message);
                    } else {
                        $('#custom_message_for_this_user').val('');
                    }
                },
                error: (xhr) => {
                    if (xhr.status === 404) {
                        $('#custom_message_for_this_user').val('');
                    } else {
                        showMessageModal('Error', xhr.responseJSON.error || 'An error occurred while retrieving the custom message.');
                    }
                }
            });
        },
        initTabs() {
            if (window.location.hash === '#services') {
                this.activeTab = 'services';
            } else if (window.location.hash === '#activity') {
                this.activeTab = 'activity';
                this.$nextTick(() => $store.activityStore.fetchLogs());
            } else if (window.location.hash === '#suspend') {
                this.activeTab = 'suspend';
            } else if (window.location.hash === '#unsuspend') {
                this.activeTab = 'unsuspend';
            } else if (window.location.hash === '#storage') {
                this.activeTab = 'storage';
                this.$nextTick(() => loadDiskUsage());
            } else if (window.location.hash === '#edit') {
                this.activeTab = 'edit';
                this.$nextTick(() => $store.ipStore.fetchIPs());
            } else if (window.location.hash === '#delete') {
                this.activeTab = 'delete';
                this.$nextTick(() => $store.ipStore.fetchIPs());
            } else if (window.location.hash === '#overview') {
                this.activeTab = 'info';
                this.$nextTick(() => this.fetchCustomMessage());
            }
        }
    }
}
</script>

                  <script>
                     document.addEventListener("alpine:init", () => {
                         Alpine.store("ipStore", {
                             fetchedips: false,
                             fetchIPs() {
                                if (this.fetchedips) return;
                                this.fetchedips = true;

                                 const ipSelect = document.getElementById('ipSelect');
                                 const currentIP = "{{ server_ip }}";

                                 fetch('/system/ips?output=json')
                                     .then(response => response.json())
                                     .then(data => {                     
                                         if (!data.ip_addresses || !Array.isArray(data.ip_addresses)) {
                                             throw new Error("Invalid response format");
                                         }
                     
                                         ipSelect.innerHTML = '<option disabled value="">Change IP address</option>';
                     
                                         data.ip_addresses.forEach(ip => {
                                             const option = document.createElement('option');
                                             option.value = ip;
                                             option.textContent = ip;
                                             if (ip === currentIP) {
                                                 option.selected = true;
                                                 option.textContent = `${ip} (Current)`;
                                             }
                                             ipSelect.appendChild(option);
                                         });
                                     })
                                     .catch(error => {
                                         console.error('Error fetching IPs:', error);
                                         this.fetchedips = false;
                     
                                         // Fallback: only display the current server IP
                                         ipSelect.innerHTML = '';
                                         const option = document.createElement('option');
                                         option.value = currentIP;
                                         option.textContent = currentIP;
                                         option.selected = true;
                                         ipSelect.appendChild(option);
                                     });
                             }
                         });
                     
                     
                     
                     
                     
                     
                     // Store for Activity Logs
                     Alpine.store("activityStore", {
                         activities: [],
                         fetchedlogs: false,
                         fetchLogs() {

                            if (this.fetchedlogs) return;
                            this.fetchedlogs = true;


                             const username = "{{ user.username }}";
                     
                             fetch(`/user_activity/${username}`)
                                 .then(response => response.json())
                                 .then(data => {
                     
                                     this.activities = [];  // Reset the activities
                     
                                     if (!data.user_activity || data.user_activity.length === 0) {
                                         // Show "No activity log yet" message if empty
                                         this.activities.push({ noActivity: true });
                                         return;
                                     }
                     
                                     // Iterate over each activity in the user_activity array
                                     data.user_activity.forEach(activity => {
                                         const date = this.formatDateString(activity.timestamp);
                                         const ip = activity.ip_address;
                                         let action = activity.action;
                                         let actionClass = '';
                     
                                         // Handle administrator actions
                                         if (activity.user_type === 'Administrator') {
                                             // Add icon and style for administrator actions
                                             action = `<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-crown" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6l4 6l5 -4l-2 10h-14l-2 -10l5 4z" /></svg> ` + action;
                     
                                             // Customize action class based on the action content
                                             if (action.includes('unsuspended')) {
                                                 actionClass = 'text-green bg-dark';
                                             } else if (action.includes('suspended')) {
                                                 actionClass = 'text-red bg-dark';
                                             } else if (action.includes('edit') || action.includes('changed')) {
                                                 actionClass = 'text-yellow bg-dark';
                                             } else {
                                                 actionClass = 'text-teal bg-dark';
                                             }
                                         }
                     
                                         // Push the activity data into the activities array
                                         this.activities.push({
                                             date: date,
                                             action: action,
                                             ip: ip,
                                             actionClass: actionClass,
                                         });
                                     });
                                 })
                                 .catch(error => {
                                     this.fetched = false;
                                     console.error('Error fetching activity logs:', error);
                                 });
                         },
                     
                         formatDateString(rawDate) {
                             const dateObj = new Date(rawDate);
                             let day = dateObj.getDate();
                             const month = dateObj.toLocaleString('en-US', { month: 'long' });
                             const year = dateObj.getFullYear();
                             const hours = dateObj.getHours();
                             const minutes = dateObj.getMinutes();
                             const seconds = dateObj.getSeconds();
                     
                             day = day < 10 ? '0' + day : day;
                             const formattedHours = hours < 10 ? '0' + hours : hours;
                             const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                             const formattedSeconds = seconds < 10 ? '0' + seconds : seconds;
                     
                             const currentDate = new Date();
                             const currentYear = currentDate.getFullYear();
                     
                             if (year !== currentYear) {
                                 return `${day}.${month}.${year} ${formattedHours}:${formattedMinutes}`;
                             } else {
                                 return `${day}.${month} ${formattedHours}:${formattedMinutes}`;
                             }
                         }
                     });
                     
                     
                     });
                  </script>





   <div class="relative w-full p-6 text-left shadow-sm bg-white dark:bg-[#090E1A] border-gray-200 dark:border-gray-900 !p-0">
      <div class="grid-cols-12 divide-y divide-gray-200 dark:divide-gray-800 md:grid md:divide-x md:divide-y-0">
         <!-- Sidebar Navigation -->
         <div class="hidden sm:flex p-4 divide-y divide-gray-200 px-2 dark:divide-gray-800 md:col-span-2">
            <nav aria-label="core navigation links" class="flex flex-1 flex-col space-y-10">
               <div>
                  <span class="block h-6 text-xs font-medium leading-6 text-gray-500 dark:text-gray-500">Docker</span>
                  <ul class="mt-1 space-y-2">
                     <li>
                        <a @click="activeTab = 'stats'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'stats'}" class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chart-column-big size-5 shrink-0" aria-hidden="true">
                              <path d="M3 3v16a2 2 0 0 0 2 2h16"></path>
                              <rect x="15" y="5" width="4" height="12" rx="1"></rect>
                              <rect x="7" y="8" width="4" height="9" rx="1"></rect>
                           </svg>
                           Statistics
                        </a>
                     </li>
                     <li>
                        <a @click="activeTab = 'services'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'services'}" class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-compass size-5 shrink-0" aria-hidden="true">
                              <path d="m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z"></path>
                              <circle cx="12" cy="12" r="10"></circle>
                           </svg>
                           Services
                        </a>
                     </li>
                     <li>
                        <a @click="activeTab = 'storage'; loadDiskUsage()"  :class="{'text-blue-600 dark:text-blue-500': activeTab === 'storage'}" class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-table2 size-5 shrink-0" aria-hidden="true">
                              <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"></path>
                           </svg>
                           Storage
                        </a>
                     </li>
                  </ul>
               </div>
               <div>
                  <span class="block h-6 text-xs font-medium leading-6 text-gray-500 dark:text-gray-500">Account</span>
                  <ul class="mt-1 space-y-2">
                     <li>
                        <a @click="activeTab = 'info'; fetchCustomMessage()" 
                           :class="{'text-blue-600 dark:text-blue-500': activeTab === 'info'}" 
                           class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900">
                        Overview
                        </a>
                     </li>
                     <li>
                        <a @click="$store.activityStore.fetchLogs(); activeTab = 'activity'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'activity'}" class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900"> Activity
                        </a>
                     </li>
                     {% if "SUSPENDED_" in user.username %} 
                     <li>
                        <form method="POST" action="/user/unsuspend/{{ user.username.split('_')[-1] }}">
                           <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                           <button class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900 w-full" type="submit">Unsuspend</button>
                        </form>
                     </li>
                     {% else %}
                     <li>
                        <a @click="$store.ipStore.fetchIPs(); activeTab = 'edit'" 
                           :class="{'text-blue-600 dark:text-blue-500': activeTab === 'edit'}" 
                           class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900">
                        Edit
                        </a>
                     </li>
                     <li>
                        <a @click="activeTab = 'suspend'" :class="{'text-blue-600 dark:text-blue-500': activeTab === 'suspend'}" class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900"> Suspend
                        </a>
                     </li>
                     {% endif %}
                     <li>
                        <a @click="activeTab = 'delete'" :class="{'text-red-600 dark:text-red-500': activeTab === 'delete'}" class="cursor-pointer flex items-center gap-x-2.5 rounded-md p-2 text-sm font-medium transition-opacity hover:bg-gray-200/50 hover:dark:bg-gray-900"> Delete
                        </a>
                     </li>
                  </ul>
               </div>
            </nav>
         </div>
         <!-- Content Area -->
         <div class="md:col-span-10 h-auto">
            <div class="relative h-full rounded">
               <!-- DOCKER STATS -->
               <div x-show="activeTab === 'stats'">
                  <div class="relative w-full p-6 text-left shadow-sm bg-white dark:bg-[#090E1A] border-gray-200 dark:border-gray-900 overflow-hidden !p-0 sm:mx-auto">
                     <div class="p-6">
                        <h3 class="hidden text-sm font-medium text-gray-900 dark:text-gray-50">Resource usage</h3>
                        <p class="hidden text-sm text-gray-500 dark:text-gray-500">No activity measured yet.</p>
                        <div class="mt-8 grid grid-cols-2 gap-4 sm:grid-cols-4">
<!-- DISK -->
<div 
  x-data="{ hovered: false }" 
  class="flex items-center gap-4 sm:flex-col sm:justify-center sm:gap-1.5"
>
  <div class="relative">
    {% set disk_usage = ((disk.disk_used / disk.disk_hard) * 100) if disk.disk_hard != 0 else 0 %}
    {% if disk_usage > 90 %}
    {% set disk_graph_class = 'stroke-red-200 dark:stroke-red-500/40' %}
    {% elif disk_usage > 80 %}
    {% set disk_graph_class = 'stroke-orange-200 dark:stroke-orange-500/40' %}
    {% elif disk_usage > 60 %}
    {% set disk_graph_class = 'stroke-blue-200 dark:stroke-blue-500/40' %}
    {% else %}
    {% set disk_graph_class = 'stroke-gray-200 dark:stroke-gray-500/40' %}
    {% endif %}
    {% set disk_usage_clamped = disk_usage if disk_usage < 100 else 100 %}
    {% set disk_usage_rounded = disk_usage_clamped | round(2) %}
    <div 
      @mouseenter="hovered = true" 
      @mouseleave="hovered = false"
    >
      <svg width="86" height="86" viewBox="0 0 64 64" class="-rotate-90 transform" role="progress circle" aria-label="progress bar" aria-valuenow="{{ disk_usage_rounded }}" aria-valuemin="0" aria-valuemax="100" data-max="100" data-value="{{ disk_usage_rounded }}">
        <circle r="29" cx="32" cy="32" stroke-width="6" fill="transparent" stroke="currentColor" stroke-linecap="round" class="transition-colors ease-linear {{ disk_graph_class }}"></circle>
        <!-- Dynamic Circle for Progress -->
        <circle
          r="29"
          cx="32"
          cy="32"
          stroke-width="6"
          stroke-dasharray="182.212373908208 182.212373908208"
          stroke-dashoffset="{{ 182.212373908208 - (182.212373908208 * disk_usage_rounded / 100) }}"
          fill="transparent"
          stroke="currentColor"
          stroke-linecap="round"
          class="stroke-current transform-gpu transition-all duration-300 ease-in-out"
        ></circle>
      </svg>
      <div class="absolute inset-0 flex items-center justify-center">
        <!-- Percentage or Link on Hover -->
        <template x-if="!hovered">
          <span class="text-sm font-medium text-gray-900 dark:text-gray-50">{{ disk_usage_rounded }}%</span>
        </template>
        <template x-if="hovered">
            <button type="button" class="relative items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center font-medium transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 shadow-none border-transparent text-gray-900 dark:text-gray-50 group hidden h-10 text-sm sm:flex" @click="activeTab = 'storage'; loadDiskUsage()">Explore</button>
        </template>
      </div>
    </div>
  </div>
  <div class="mt-0 text-left sm:mt-2 sm:text-center">
    <p class="text-sm font-medium text-gray-900 dark:text-gray-50">
      {% if disk.disk_used != 0 %}{{ (disk.disk_used / 1024000) | round(2) }}<!---->GB{% else %}{{disk.disk_used}}<!---->B{% endif %}
      <!---->/<!---->
      {% if disk.disk_hard != 0 %}{{ (disk.disk_hard / 1024000) | round(2) }}<!---->GB{% else %}∞{% endif %}
    </p>
    <p class="text-sm text-gray-500 dark:text-gray-500">Storage used</p>
  </div>
</div>
                           <!-- END DISK -->
                           <!-- INODES -->
                           <div class="flex items-center gap-4 sm:flex-col sm:justify-center sm:gap-1.5">
                              <div class="relative">
                                 {% set inodes_usage = ((disk.inodes_used / disk.inodes_hard) * 100) if disk.inodes_hard != 0 else 0 %}
                                 {% if inodes_usage > 90 %}
                                 {% set inodes_graph_class = 'stroke-red-200 dark:stroke-red-500/40' %}
                                 {% elif inodes_usage > 80 %}
                                 {% set inodes_graph_class = 'stroke-orange-200 dark:stroke-orange-500/40' %}
                                 {% elif inodes_usage > 60 %}
                                 {% set inodes_graph_class = 'stroke-blue-200 dark:stroke-blue-500/40' %}
                                 {% else %}
                                 {% set inodes_graph_class = 'stroke-gray-200 dark:stroke-gray-500/40' %}
                                 {% endif %}
                                 {% set inodes_usage_clamped = inodes_usage if inodes_usage < 100 else 100 %}
                                 {% set inodes_usage_rounded = inodes_usage_clamped | round(2) %}

                                <svg width="86" height="86" viewBox="0 0 64 64" class="-rotate-90 transform" role="progress circle" aria-label="progress bar" aria-valuenow="{{ inodes_usage_rounded }}" aria-valuemin="0" aria-valuemax="100" data-max="100" data-value="{{ inodes_usage_rounded }}">
                                <circle r="29" cx="32" cy="32" stroke-width="6" fill="transparent" stroke="currentColor" stroke-linecap="round" class="transition-colors ease-linear {{ inodes_graph_class }}"></circle>
                                <!-- Dynamic Circle for Progress -->
                                <circle
                                    r="29"
                                    cx="32"
                                    cy="32"
                                    stroke-width="6"
                                    stroke-dasharray="182.212373908208 182.212373908208"
                                    stroke-dashoffset="{{ 182.212373908208 - (182.212373908208 * inodes_usage_rounded / 100) }}"
                                    fill="transparent"
                                    stroke="currentColor"
                                    stroke-linecap="round"
                                    class="stroke-current transform-gpu transition-all duration-300 ease-in-out"
                                ></circle>
                                </svg>
                                 <div class="absolute inset-0 flex items-center justify-center"><span class="text-sm font-medium text-gray-900 dark:text-gray-50">{{ inodes_usage_rounded }}%</span></div>
                              </div>
                              <div class="mt-0 text-left sm:mt-2 sm:text-center">
                                <p class="text-sm font-medium text-gray-900 dark:text-gray-50">
                                {% if disk.inodes_used != 0 %}
                                    {% if disk.inodes_used >= 1000000 %}
                                    {{ (disk.inodes_used / 1000000) | round(2) }}M
                                    {% else %}
                                    {{ disk.inodes_used }}
                                    {% endif %}
                                {% else %}
                                    {{ disk.inodes_used }}
                                {% endif %}
                                /
                                {% if disk.inodes_hard != 0 %}
                                    {% if disk.inodes_hard >= 1000000 %}
                                    {{ (disk.inodes_hard / 1000000) | round(2) }}M
                                    {% else %}
                                    {{ disk.inodes_hard }}
                                    {% endif %}
                                {% else %}
                                    ∞
                                {% endif %}
                                </p>
                                 <p class="text-sm text-gray-500 dark:text-gray-500">Inodes used</p>
                              </div>
                           </div>
                           <!-- END INODES -->
                           <!-- CPU -->
                           <div class="flex items-center gap-4 sm:flex-col sm:justify-center sm:gap-1.5">
                              <div class="relative">
                                 <svg id="cpu_graph" width="86" height="86" viewBox="0 0 64 64" class="-rotate-90 transform" role="progress circle" aria-label="progress bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-max="100" data-value="0">
                                    <circle r="29" cx="32" cy="32" stroke-width="6" fill="transparent" stroke="currentColor" stroke-linecap="round" class="transition-colors ease-linear stroke-gray-200 dark:stroke-gray-500/40"></circle>
                                    <circle
                                       r="29"
                                       cx="32"
                                       cy="32"
                                       stroke-width="6"
                                       stroke-dasharray="182.212373908208 182.212373908208"
                                       stroke-dashoffset="182.212373908208"
                                       fill="transparent"
                                       stroke=""
                                       stroke-linecap="round"
                                       class="stroke-gray-500 dark:stroke-gray-500 transform-gpu transition-all duration-300 ease-in-out"
                                       ></circle>
                                 </svg>
                                 <div class="absolute inset-0 flex items-center justify-center"><span class="text-sm font-medium text-gray-900 dark:text-gray-50"><span id="cpu_percentage">0%</span></span></div>
                              </div>
                              <div class="mt-0 text-left sm:mt-2 sm:text-center">
                                 <p class="text-sm font-medium text-gray-900 dark:text-gray-50"><span id="global_cpu_usage">0</span> / {{ (env_data.TOTAL_CPU|int * 100) | round(2) if env_data.TOTAL_CPU != 0 else '∞' }}%</p>
                                 <p class="text-sm text-gray-500 dark:text-gray-500">CPU usage</p>
                              </div>
                           </div>
                           <!-- END CPU -->
                           <!-- RAM -->
                           <div class="flex items-center gap-4 sm:flex-col sm:justify-center sm:gap-1.5">
                              <div class="relative">
                                 <svg id="ram_graph" width="86" height="86" viewBox="0 0 64 64" class="-rotate-90 transform" role="progress circle" aria-label="progress bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-max="100" data-value="0">
                                    <circle r="29" cx="32" cy="32" stroke-width="6" fill="transparent" stroke="currentColor" stroke-linecap="round" class="transition-colors ease-linear stroke-gray-200 dark:stroke-gray-500/40"></circle>
                                    <circle
                                       r="29"
                                       cx="32"
                                       cy="32"
                                       stroke-width="6"
                                       stroke-dasharray="182.212373908208 182.212373908208"
                                       stroke-dashoffset="182.212373908208"
                                       fill="transparent"
                                       stroke=""
                                       stroke-linecap="round"
                                       class="stroke-gray-500 dark:stroke-gray-500 transform-gpu transition-all duration-300 ease-in-out"
                                       ></circle>
                                 </svg>
                                 <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-sm font-medium text-gray-900 dark:text-gray-50"><span id="ram_percentage">0%</span></span>
                                 </div>
                              </div>
                              <div class="mt-0 text-left sm:mt-2 sm:text-center">
                                 <p class="text-sm font-medium text-gray-900 dark:text-gray-50"><span id="global_ram_usage">0 / {{ (env_data.TOTAL_RAM[:-1]|int * 1024 if env_data.TOTAL_RAM.endswith('g') else '∞') }} MiB</span>
                                 </p>
                                 <p class="text-sm text-gray-500 dark:text-gray-500">Memory usage</p>
                              </div>
                           </div>
                           <!-- END RAM -->
                        </div>
                     </div>
                     <div class="grid grid-cols-2 gap-4 p-4">
                        <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Running containers:</span><span class="font-medium"><a href="#" @click="activeTab = 'services'" class="inline-flex items-center gap-1 rounded text-sm text-blue-500 hover:underline hover:underline-offset-4 dark:text-blue-500">{{ stats.stats.Container }}</a></span></div>
                        <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Disk I/O:</span><span class="font-medium">{{ stats.stats.BlockIO }}</span></div>
                        <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Network I/O:</span><span class="font-medium">{{ stats.stats.NetIO }}</span></div>
                        <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">PIDs:</span><a href="/server/processes?sort=owner&owner={{ user.username.split('_')[-1] }}" class="font-medium">{{ stats.stats.PIDs }}</a></div>
                     </div>

<div class="flex justify-between mt-4 border-t border-gray-200 bg-gray-50 px-6 py-4 dark:border-gray-900 dark:bg-gray-950">
  <div>
    <h4 class="text-sm font-medium text-gray-900 dark:text-gray-50">Usage updated hourly</h4>
    <p class="mt-0.5 text-sm text-gray-500 dark:text-gray-500">                           Docker stats last updated at: {{ stats.date }}<!-- --></p>
  </div>
  <div>
    <button id="get_docker_history_usage" class="relative inline-flex items-center justify-center gap-1.5 whitespace-nowrap rounded-md border p-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600">
      Load Docker Usage History
    </button>
  </div>
</div>


<div id="docker_stats_history" class="hidden overflow-x-auto">
  <div class="w-full overflow-auto whitespace-nowrap border-t border-gray-200 dark:border-gray-800">
    <table id="usage" class="w-full caption-bottom border-b border-gray-200 dark:border-gray-800">
      <thead>
        <tr class="bg-gray-50 dark:bg-gray-900 sm:[&amp;_td:last-child]:pr-6 sm:[&amp;_th:last-child]:pr-6 sm:[&amp;_td:first-child]:pl-6 sm:[&amp;_th:first-child]:pl-6">
<th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
     <div class="inline-flex items-center gap-2">
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-calendar-month"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z" /><path d="M16 3v4" /><path d="M8 3v4" /><path d="M4 11h16" /><path d="M8 14v4" /><path d="M12 14v4" /><path d="M16 14v4" /></svg> Date
      </div>

          </th>

<th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
        <div class="inline-flex items-center gap-2">
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-box"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3l8 4.5l0 9l-8 4.5l-8 -4.5l0 -9l8 -4.5" /><path d="M12 12l8 -4.5" /><path d="M12 12l0 9" /><path d="M12 12l-8 -4.5" /></svg> Containers
      </div>

          </th>

<th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
     <div class="inline-flex items-center gap-2">
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-cpu"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 5m0 1a1 1 0 0 1 1 -1h12a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-12a1 1 0 0 1 -1 -1z" /><path d="M9 9h6v6h-6z" /><path d="M3 10h2" /><path d="M3 14h2" /><path d="M10 3v2" /><path d="M14 3v2" /><path d="M21 10h-2" /><path d="M21 14h-2" /><path d="M14 21v-2" /><path d="M10 21v-2" /></svg> CPU %
      </div>

          </th>
<th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
     <div class="inline-flex items-center gap-2">
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-database"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6m-8 0a8 3 0 1 0 16 0a8 3 0 1 0 -16 0" /><path d="M4 6v6a8 3 0 0 0 16 0v-6" /><path d="M4 12v6a8 3 0 0 0 16 0v-6" /></svg> Memory %
      </div>


          </th>
<th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
     <div class="inline-flex items-center gap-2">
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-network"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9a6 6 0 1 0 12 0a6 6 0 0 0 -12 0" /><path d="M12 3c1.333 .333 2 2.333 2 6s-.667 5.667 -2 6" /><path d="M12 3c-1.333 .333 -2 2.333 -2 6s.667 5.667 2 6" /><path d="M6 9h12" /><path d="M3 20h7" /><path d="M14 20h7" /><path d="M10 20a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M12 15v3" /></svg> Net I/O
      </div>

          </th>
<th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
     <div class="inline-flex items-center gap-2">

            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-floppy"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" /><path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M14 4l0 4l-6 0l0 -4" /></svg> Block I/O
      </div>

          </th>
        </tr>
      </thead>
      <tbody id="usageTableBody" class="divide-y divide-gray-200 dark:divide-gray-800">
        <!-- Data rows will be injected here -->
      </tbody>
    </table>
  </div>
</div>
<script>
  const username = '{{ user.username.split("_")[-1] }}';
  const fetchButton = document.getElementById("get_docker_history_usage");
  const container = document.getElementById("docker_stats_history");
  const tbody = document.getElementById("usageTableBody");

  let alreadyFetched = false;

  fetchButton.addEventListener("click", () => {
    if (alreadyFetched) return; // prevent multiple fetches
    alreadyFetched = true;

    container.classList.remove("hidden");

    fetch(`/get_resource_usage_history/${username}`)
      .then(response => {
        if (!response.ok) throw new Error('Failed to fetch resource usage history');
        return response.text();
      })
      .then(text => {
        const lines = text.trim().split('\n').reverse();

        lines.forEach(line => {
          const spaceIndex = line.indexOf(' ');
          if (spaceIndex === -1) return;

          const timestamp = line.slice(0, spaceIndex);
          const jsonStr = line.slice(spaceIndex + 1);

          let usage;
          try {
            usage = JSON.parse(jsonStr);
          } catch (e) {
            return;
          }

          const cpuPercent = parseFloat(usage.CPUPerc.replace('%', '').trim()) || 0;
          const memPercent = parseFloat(usage.MemPerc.replace('%', '').trim()) || 0;

          const tr = document.createElement('tr');
          tr.className = "sm:[&_td:last-child]:pr-6 sm:[&_td:first-child]:pl-6 hover:bg-white dark:hover:bg-gray-900";

          tr.innerHTML = `
            <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">${timestamp}</td>
            <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">${usage.Container}</td>
            <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">${cpuPercent}</td>
            <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">${memPercent}</td>
            <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">${usage.NetIO}</td>
            <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">${usage.BlockIO}</td>
          `;
          tbody.appendChild(tr);
        });
      })
      .catch(error => {
        console.error(error);
        tbody.innerHTML = `<tr><td colspan="5" class="text-center p-4 text-red-600">Error loading usage data: ${error.message}</td></tr>`;
      });
  });
</script>



<!-- END usage table -->




                  </div>
               </div>
               <!-- END DOCKER STATS -->
               <!-- DOCKER SERVICES -->
               <div x-show="activeTab === 'services'" x-cloak 
                  x-data="Object.assign({ searchQuery: '' }, userTable())" 
                  x-init="init()">                 
                 
                 
                 
                  <div class="flex flex-col justify-between gap-2 px-4 py-6 sm:flex-row sm:items-center sm:p-6">
                     <div class="relative w-full sm:w-64 [&amp;>input]:py-1.5">
                        <input
                           x-model="searchQuery"
                           class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-none focus:outline-none disabled:pointer-events-none file:disabled:pointer-events-none file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100 file:dark:border-gray-800 file:dark:bg-gray-950 file:hover:dark:bg-gray-900/20 file:disabled:dark:border-gray-700 file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem] file:disabled:bg-gray-100 file:disabled:text-gray-500 file:disabled:dark:bg-gray-800 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 [&amp;::-webkit-search-cancel-button]:hidden [&amp;::-webkit-search-decoration]:hidden pl-8"
                           placeholder="Search containers..."
                           type="search"
                           />
                        <div class="pointer-events-none absolute bottom-0 left-2 flex h-full items-center justify-center text-gray-400 dark:text-gray-600">
                           <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-[1.125rem] shrink-0">
                              <path
                                 d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"
                                 ></path>
                           </svg>
                        </div>
                     </div>

                     <div class="relative w-full sm:w-64 [&amp;>input]:py-1.5">
                        <!-- Dropdown for Column Visibility -->
                        <div class="relative">
                              <button id="dropdownToggleButton" data-dropdown-toggle="dropdownToggle" class="relative items-center justify-center whitespace-nowrap rounded-md border text-center font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-indigo-500 dark:outline-indigo-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 ml-auto hidden gap-x-2 px-2 py-1.5 text-sm sm:text-xs lg:flex cursor-pointer" type="button"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-4"><path d="M5 7C5 6.17157 5.67157 5.5 6.5 5.5C7.32843 5.5 8 6.17157 8 7C8 7.82843 7.32843 8.5 6.5 8.5C5.67157 8.5 5 7.82843 5 7ZM6.5 3.5C4.567 3.5 3 5.067 3 7C3 8.933 4.567 10.5 6.5 10.5C8.433 10.5 10 8.933 10 7C10 5.067 8.433 3.5 6.5 3.5ZM12 8H20V6H12V8ZM16 17C16 16.1716 16.6716 15.5 17.5 15.5C18.3284 15.5 19 16.1716 19 17C19 17.8284 18.3284 18.5 17.5 18.5C16.6716 18.5 16 17.8284 16 17ZM17.5 13.5C15.567 13.5 14 15.067 14 17C14 18.933 15.567 20.5 17.5 20.5C19.433 20.5 21 18.933 21 17C21 15.067 19.433 13.5 17.5 13.5ZM4 16V18H12V16H4Z"></path></svg> Show Columns</button>

                              <!-- Dropdown menu -->
                              <div id="dropdownToggle" class="z-10 text-sm shadow-md border border-gray-200 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-gray-50 dark:bg-gray-950 divide-y divide-gray-100 rounded-lg shadow-sm w-72 dark:divide-gray-600 hidden">
                                 <ul class="p-2 space-y-1" aria-labelledby="dropdownToggleButton">
                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.name" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Name</span>
                                             </label>
                                          </div>
                                    </li>
                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.image" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Image</span>
                                             </label>
                                          </div>
                                    </li>
                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.ports" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Ports</span>
                                             </label>
                                          </div>
                                    </li>
                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.env" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Enviroment</span>
                                             </label>
                                          </div>
                                    </li>
                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.cpu" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">CPU Usage</span>
                                             </label>
                                          </div>
                                    </li>
                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.ram" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Memory Usage</span>
                                             </label>
                                          </div>
                                    </li>


                                    <li>
                                          <div class="flex py-1 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                                             <label class="inline-flex items-center w-full cursor-pointer">
                                                <input type="checkbox" x-model="columns.actions" x-on:change="saveColumns" class="sr-only peer">
                                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Actions</span>
                                             </label>
                                          </div>
                                    </li>
                                 </ul>
                              </div>
                        </div>
                     </div>



                  </div>
                  <div class="overflow-x-auto">
                     <div class="w-full overflow-auto whitespace-nowrap border-t border-gray-200 dark:border-gray-800">
                        <table id="databases-table" class="w-full caption-bottom border-b border-gray-200 dark:border-gray-800">
                           <thead class="">
                              <tr class="whitespace-nowrap border-b px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 bg-gray-50 py-3 pl-4 sm:pl-6 dark:bg-gray-900">
                                 <th x-show="columns.name" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    Name
                                 </th>

                                 <th x-show="columns.image" scope="col"  class="w-10 whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    Image
                                 </th>
                                 <th x-show="columns.ports" scope="col"  class="w-10 whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    Ports
                                 </th>
                                 <th x-show="columns.env" scope="col"  class="w-10 whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    Env
                                 </th>                                 
                                 <th x-show="columns.cpu" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    CPU
                                 </th>
                                 <th x-show="columns.ram" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    Memory
                                 </th>
                                 <th x-show="columns.actions" scope="col" class="w-10 whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">
                                    Actions
                                 </th>
                              </tr>
                           </thead>
                           <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
                              {% if docker_data.services %}
                              {% for service, details in docker_data.services.items() %}
                              <tr x-show="searchQuery === '' || '{{ details.container_name }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ service }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ details.image }}'.toLowerCase().includes(searchQuery.toLowerCase())" class="domain_row sm:[&_td:last-child]:pr-6 sm:[&_td:first-child]:pl-6 hover:bg-white dark:hover:bg-gray-900">
                                 <td x-show="columns.name">
                                    <div class="flex flex-col gap-1">
                                       <span class="font-medium text-gray-900 dark:text-gray-50">{{ details.container_name if details.container_name else service }}</span>
                                    </div>
                                 </td>

                                 <td x-show="columns.image">
                                    <div class="flex flex-col gap-1">
                                       <div class="flex items-center gap-1 text-xs">
                                          <span class="font-mono font-medium uppercase tabular-nums text-gray-900 dark:text-gray-50">{{ details.image }}</span>
                                          {% if 'httpd' in details.image or 'busybox' in details.image or 'elasticsearch' in details.image or 'mariadb' in details.image or 'memcached' in details.image or 'mysql' in details.image or 'redis' in details.image or 'nginx' in details.image or '-fpm' in details.image or 'openpanel' in details.image or 'phpmyadmin' in details.image or 'varnish' in details.image %}
                                          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="remixicon size-3 shrink-0 text-emerald-600 dark:text-emerald-400">
                                             <path d="M12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598L12 1ZM16.4524 8.22183L11.5019 13.1709L8.67421 10.3431L7.25999 11.7574L11.5026 16L17.8666 9.63604L16.4524 8.22183Z"></path>
                                          </svg>
                                          {% else %}
                                          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="remixicon size-3 shrink-0 text-gray-400 dark:text-gray-600">
                                             <path d="M12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598L12 1ZM16.4524 8.22183L11.5019 13.1709L8.67421 10.3431L7.25999 11.7574L11.5026 16L17.8666 9.63604L16.4524 8.22183Z"></path>
                                          </svg>
                                          {% endif %}
                                       </div>
                                    </div>
                                 </td>



                                 <td x-show="columns.ports" class="px-2">
        <div class="flex flex-col">
  {% if details.ports %}
    {% for port in details.ports %}
      {% if port.published != '0' %}
        <span class="text-xs font-medium text-gray-500 dark:text-gray-500">{{ port.host_ip }}:{{ port.published }} → {{ port.target }}</span>
      {% endif %}
    {% endfor %}
  {% endif %}                                    
         </div>
                                 </td>
                                 <td x-show="columns.env" class="px-2">
  {% if details.environment %}
        <div class="flex flex-col">
      {% for key, value in details.environment.items() %}
        <span class="text-xs text-gray-500 dark:text-gray-500">{{ key }}: <span class="font-medium">{{ value }}</span></span>
      {% endfor %}
        </div>
  {% endif %}                                    
                                 </td>


<td x-show="columns.cpu" x-data="{ editing: false, value: '{{ details.deploy.resources.limits.cpus if details.deploy.resources.limits.cpus else "0" }}' }"
    class="relative group cursor-pointer p-4 text-sm relative whitespace-nowrap py-2.5 text-gray-600 dark:text-gray-400 text-left">
    
    <div class="flex gap-2">
        <!-- CPU Usage -->
        <div id="cpu-{{ service }}">
            <div class="flex items-center gap-x-2.5">
                <div class="relative" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <svg width="28" height="28" viewBox="0 0 28 28" class="-rotate-90 transform">
                        <circle r="12.5" cx="14" cy="14" stroke-width="3" fill="transparent" class="stroke-gray-100 dark:stroke-gray-500/30"></circle>
                        <circle r="12.5" cx="14" cy="14" stroke-width="3" stroke-dasharray="78.54" stroke-dashoffset="78.54" fill="transparent" class="stroke-blue-500 dark:stroke-blue-500 transition-all duration-300"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-[11px] font-semibold">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text and Edit Icon Section -->
        <div class="flex flex-col gap-0">
            <span class="text-gray-900 dark:text-gray-50">
                <span class="text-xs text-gray-500 dark:text-gray-500">Usage: </span>
                <span class="font-medium" id="cpu-usage-{{ service }}"></span>
            </span>
            <span class="flex items-center justify-center text-xs text-gray-500 dark:text-gray-500">
                <input id="cpu-allocated-{{service}}" type="hidden" value="{{ total_cpu }}">
                Allocated: &nbsp;
                <span x-show="!editing"><span class="font-medium" x-text="value"></span> cores <a href="#" @click.prevent="editing = !editing" class="transform hidden group-hover:inline-block text-gray-400 hover:text-gray-600"><span x-show="!editing"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
  <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>
</svg></a></span>
            <!-- Editable Input and Save Button -->
            <form action="/containers/{{ user.username.split('_')[-1] }}/cpu/{{ service }}" method="POST" x-show="editing" @click.stop="editing = true" class="flex items-center gap-2">

    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>


                <input x-model="value" name="value" type="number" min="0.10" {% if total_cpu != 0 %} max="{{ total_cpu }}" {% endif %} step=".01" class="w-20 px-2 py-1 border rounded-md dark:bg-gray-700 dark:text-white" />
                <button type="submit" class="px-2 py-1 text-white bg-blue-500 rounded-md hover:bg-blue-600">Save</button>
            </form>
            </span>
        </div>
    </div>
</td>






<td x-show="columns.ram" x-data="{ editing: false, value: '{% if details.deploy.resources.limits.memory %}{{ (details.deploy.resources.limits.memory | int / (1024 ** 3)) | round(2) }}{% else %}0{% endif %}' }"
    class="relative group cursor-pointer p-4 text-sm relative whitespace-nowrap py-2.5 text-gray-600 dark:text-gray-400 text-left">
    
    <div class="flex gap-2">
        <!-- CPU Usage -->
        <div id="ram-{{ service }}">
            <div class="flex items-center gap-x-2.5">
                <div class="relative" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <svg width="28" height="28" viewBox="0 0 28 28" class="-rotate-90 transform">
                        <circle r="12.5" cx="14" cy="14" stroke-width="3" fill="transparent" class="stroke-gray-100 dark:stroke-gray-500/30"></circle>
                        <circle r="12.5" cx="14" cy="14" stroke-width="3" stroke-dasharray="78.54" stroke-dashoffset="78.54" fill="transparent" class="stroke-blue-500 dark:stroke-blue-500 transition-all duration-300"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-[11px] font-semibold">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text and Edit Icon Section -->
        <div class="flex flex-col gap-0">
            <span class="text-gray-900 dark:text-gray-50">
                <span class="text-xs text-gray-500 dark:text-gray-500">Usage: </span>
                <span class="font-medium" id="ram-usage-{{ service }}"></span>
            </span>
            <span class="flex items-center justify-center text-xs text-gray-500 dark:text-gray-500">
                Allocated: &nbsp;
                <span x-show="!editing"><span class="font-medium">{% if details.deploy.resources.limits.memory %}{{ (details.deploy.resources.limits.memory | int / (1024 ** 3)) | round(2) }} GB{% else %}∞{% endif %} </span> <a href="#" @click.prevent="editing = !editing" class="transform hidden group-hover:inline-block text-gray-400 hover:text-gray-600"><span x-show="!editing"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
  <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>
</svg></a></span>
            <!-- Editable Input and Save Button -->
            <form action="/containers/{{ user.username.split('_')[-1] }}/ram/{{ service }}" method="POST" x-show="editing" @click.stop="editing = true" class="flex items-center gap-2">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

    <input x-model="value" name="value" type="number" min="0.10" {% if total_ram != 0 %} max="{{ total_ram }}" {% endif %} step=".01" class="w-20 px-2 py-1 border rounded-md dark:bg-gray-700 dark:text-white" />

                <button type="submit" class="px-2 py-1 text-white bg-blue-500 rounded-md hover:bg-blue-600">Save</button>
            </form>
            </span>

            
            </a>
        </div>
    </div>
</td>


                    <td x-show="columns.actions" id="actions-{{ service }}" x-data="{ pullValue: 'false' }">
                        <form method="POST" action="/containers/{{ user.username.split('_')[-1] }}/start/{{ details.container_name if details.container_name else service }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        
    <!-- Hidden input with dynamic value based on mouse click -->
                            <input type="hidden" name="pull" class="pullInput" :value="pullValue">

                            <button
                                type="submit"
                                class="w-full relative inline-flex items-center justify-center gap-1.5 whitespace-nowrap rounded-md border px-2 py-1 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600"
                               
                                @contextmenu.prevent="pullValue = 'true'; $nextTick(() => $el.closest('form').submit())"
                            >
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-4 shrink-0 text-gray-400 dark:text-gray-600">
                                    <path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 10.5858L9.17157 7.75736L7.75736 9.17157L10.5858 12L7.75736 14.8284L9.17157 16.2426L12 13.4142L14.8284 16.2426L16.2426 14.8284L13.4142 12L16.2426 9.17157L14.8284 7.75736L12 10.5858Z"></path>
                                </svg>
                                Disabled
                            </button>
                        </form>
                    </td>
                              </tr>
                              {% endfor %}

<script>
function userTable() {
    return {
        searchQuery: '',
        filters: {
            active: true,
            suspended: true
        },
        columns: {
            name: true,
            image: false,
            ports: false,
            env: false,
            cpu: true,
            ram: true,
            actions: true
        },

        init() {
            this.loadColumns();
        },


        saveColumns() {
            localStorage.setItem('columns-singe-user', JSON.stringify(this.columns));
        },

        loadColumns() {
            const saved = localStorage.getItem('columns-singe-user');
            if (saved) {
                try {
                    this.columns = JSON.parse(saved);
                } catch (e) {
                    console.warn("Failed to parse columns-singe-user from localStorage", e);
                }
            }
        }
    };
}
</script>





                              {% else %}
                              <tr>
                                 <td colspan="6" class="p-6 text-center">
                                    docker-compose.yml file is invalid or missing.
                                 </td>
                              </tr>
                              {% endif %}
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
               <!-- JS for stats -->
               <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
               <script>
                  $(document).ready(function() {
                             
                  // Helper function to update the circle graph based on percentage
                  function updateProgressBar(elementId, percentage) {
                      const circle = document.querySelector(`#${elementId} circle:nth-of-type(2)`);
                      const radius = circle.getAttribute('r');
                      const circumference = 2 * Math.PI * radius;
                      
                      // Calculate the stroke-dashoffset based on the percentage
                      const offset = circumference - (percentage / 100) * circumference;
                      
                      // Update the stroke-dashoffset to visually represent the progress
                      circle.style.strokeDashoffset = offset;
                  }
                  
                  // Update CPU usage graph
                  function updateCpuUsage(cpuPercentage) {
                  
                      let totalCpuStr = "{{ env_data.TOTAL_CPU }}";
                  
                      if (totalCpuStr !== "0") {
                          const totalCpu= parseFloat(totalCpuStr);
                          const result = cpuPercentage / totalCpu;
                          document.getElementById('cpu_percentage').textContent = `${result.toFixed(2)}%`;
                          updateProgressBar('cpu_graph', result);
                      } else {
                          document.getElementById('cpu_percentage').textContent = `${cpuPercentage}%`;
                          updateProgressBar('cpu_graph', cpuPercentage);
                      }
                  
                  
                  
                  
                  }
                  
                  // Update RAM usage graph
function updateRamUsage(ramPercentage) {
    let totalRamStr = "{{ env_data.TOTAL_RAM }}";

    if (totalRamStr.toUpperCase().endsWith('G')) {
        totalRamStr = totalRamStr.slice(0, -1);
        const totalRam = parseFloat(totalRamStr);

        if (!isNaN(totalRam) && totalRam > 0) {
            const result = ramPercentage / totalRam;
            document.getElementById('ram_percentage').textContent = `${result.toFixed(2)}%`;
            updateProgressBar('ram_graph', result);
        } else {
            document.getElementById('ram_percentage').textContent = `${ramPercentage}%`;
            updateProgressBar('ram_graph', ramPercentage);
        }
    } else {
        document.getElementById('ram_percentage').textContent = `${ramPercentage}%`;
        updateProgressBar('ram_graph', ramPercentage);
    }
}

                  
                  
                  
                  
                  $.ajax({
                      url: '/containers/stats/{{ user.username.split('_')[-1] }}',
                      method: 'GET',
                      success: function(response) {
                          let totalCpuUsage = 0;  // Initialize totalCpuUsage
                          let totalMemUsage = 0;  // Initialize totalMemUsage
                  
                          var currentRamUsage = 0; // Total current RAM usage
                          var totalRamAllocated = 0; // Total RAM allocated across all containers
                          
                          if (response.container_stats) {
                              if (response.container_stats.length === 0) {
                                  // Case when container stats are available but empty
                              } else {
                                  response.container_stats.forEach(function(container) {
                                      var containerName = container.Name;
                                      var containerId = containerName.replace(/\./g, '\\.');
                                      var ramCell = $('#ram-' + containerId);
                                      var actionsCell = $('#actions-' + containerId);
                                      var cpuCell = $('#cpu-' + containerId);
                  
                                      var ramText = $('#ram-usage-' + containerId);
                                      var cpuText = $('#cpu-usage-' + containerId);
                  
                                      // cpu
                                      var cpuUsage = parseFloat(container.CPUPerc.replace('%', '')) || 0;
                                      var memUsage = parseFloat(container.MemPerc.replace('%', '')) || 0;
                                      totalMemUsage += memUsage;
                                      totalCpuUsage += cpuUsage;
                  
                                      // ram
                                      var memUsageSingle = container.MemUsage.split(' / '); // Splits "1.68MiB / 102.4MiB"
                                      var currentMemUsage = parseFloat(memUsageSingle[0].replace(/[A-Za-z]/g, '')) || 0; // Convert to number
                                      var totalMemAllocated = parseFloat(memUsageSingle[1].replace(/[A-Za-z]/g, '')) || 0; // Convert to number
                                      currentRamUsage += currentMemUsage;
                                      totalRamAllocated += totalMemAllocated;
                                      
                                      // Calculate stroke-dashoffset (Max circumference of the circle is 78.54)
                                      var cpuDashOffset = 78.54 * (1 - cpuUsage / 100);
                                      var memDashOffset = 78.54 * (1 - memUsage / 100);
                  
                                      var cpuTextInfo = `${container.CPUPerc}`;
                                      cpuText.html(cpuTextInfo);
                  
                                      var memUsageOnly = container.MemUsage.split('/')[0].trim(); 
                                      var ramTextInfo = `${memUsageOnly}`;
                                      ramText.html(ramTextInfo);
                  
                                      // Generate stats display with circular progress bars
                                      var cpuInfo = `
                                          <div class="flex gap-2">
                                              <!-- CPU Usage -->
                                              <div class="flex items-center gap-x-2.5">
                                                  <div class="relative" role="progressbar" aria-valuenow="${cpuUsage}" aria-valuemin="0" aria-valuemax="100">
                                                      <svg width="28" height="28" viewBox="0 0 28 28" class="-rotate-90 transform">
                                                          <circle r="12.5" cx="14" cy="14" stroke-width="3" fill="transparent" class="stroke-gray-100 dark:stroke-gray-500/30"></circle>
                                                          <circle r="12.5" cx="14" cy="14" stroke-width="3" stroke-dasharray="78.54" stroke-dashoffset="${cpuDashOffset}" fill="transparent" 
                                                          class="${cpuUsage < 50 ? 'stroke-blue-500' : cpuUsage < 80 ? 'stroke-green-500' : cpuUsage < 90 ? 'stroke-orange-500' : 'stroke-red-500'} dark:${cpuUsage < 50 ? 'stroke-blue-500' : cpuUsage < 80 ? 'stroke-green-500' : cpuUsage < 90 ? 'stroke-orange-500' : 'stroke-red-500'} transition-all duration-300">
                                                          </circle>
                                                      </svg>
                                                      <div class="absolute inset-0 flex items-center justify-center">
                                                          <span class="text-[11px] font-semibold">${Math.round(cpuUsage)}</span>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      `;
                                      cpuCell.html(cpuInfo);
                  
                                      var ramInfo = `
                                          <div class="flex gap-2">
                                              <!-- Memory Usage -->
                                              <div class="flex items-center gap-x-2.5">
                                                  <div class="relative" role="progressbar" aria-valuenow="${memUsage}" aria-valuemin="0" aria-valuemax="100">
                                                      <svg width="28" height="28" viewBox="0 0 28 28" class="-rotate-90 transform">
                                                          <circle r="12.5" cx="14" cy="14" stroke-width="3" fill="transparent" class="stroke-gray-100 dark:stroke-gray-500/30"></circle>
                                                          <circle r="12.5" cx="14" cy="14" stroke-width="3" stroke-dasharray="78.54" stroke-dashoffset="${memDashOffset}" fill="transparent" 
                                                          class="${memUsage < 50 ? 'stroke-blue-500' : memUsage < 80 ? 'stroke-green-500' : memUsage < 90 ? 'stroke-orange-500' : 'stroke-red-500'} dark:${memUsage < 50 ? 'stroke-blue-500' : memUsage < 80 ? 'stroke-green-500' : memUsage < 90 ? 'stroke-orange-500' : 'stroke-red-500'} transition-all duration-300">                                        
                                                          </circle>
                                                      </svg>
                                                      <div class="absolute inset-0 flex items-center justify-center">
                                                          <span class="text-[11px] font-semibold">${Math.round(memUsage)}</span>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      `;
                                      ramCell.html(ramInfo);
                  
                                      var actionsInfo = `
                                          <form method="POST" action="/containers/{{ user.username.split('_')[-1] }}/stop/${containerId}"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}"><button type="button" class="w-full relative inline-flex items-center justify-center gap-1.5 whitespace-nowrap rounded-md border px-2 py-1 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-4 shrink-0 text-emerald-600 dark:text-emerald-500"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM17.4571 9.45711L11 15.9142L6.79289 11.7071L8.20711 10.2929L11 13.0858L16.0429 8.04289L17.4571 9.45711Z"></path></svg>Enabled</button></form>
                                          <a href="/terminal/{{ user.username.split('_')[-1] }}/${containerId}" class="mt-2 w-full relative inline-flex items-center justify-center gap-1.5 whitespace-nowrap rounded-md border px-2 py-1 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-terminal" viewBox="0 0 16 16"> <path d="M6 9a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 6 9M3.854 4.146a.5.5 0 1 0-.708.708L4.793 6.5 3.146 8.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708z"/>  <path d="M2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z"/></svg>Terminal</a>`;
                                      actionsCell.html(actionsInfo);
                  
                                  });
                                  $('#total_records_count').text(response.container_stats.length);
                                  
                                  // Update the global stats
                                  const cpuPercentage = Math.round(totalCpuUsage); // total CPU percentage across all containers
                                  const ramPercentage = Math.round(totalMemUsage); // total RAM percentage across all containers
                  
                                  // Update the global CPU and RAM usage
                                  $('#global_cpu_usage').text(`${Math.round(totalCpuUsage)}`);
                                  $('#global_ram_usage').text(`${Math.round(currentRamUsage)}MiB / ${Math.round(totalRamAllocated)}MiB`);
                  
                                  updateCpuUsage(cpuPercentage);
                                  updateRamUsage(ramPercentage);
                              }
                          }
                      },
                      error: function(error) {
                          console.error("Error fetching container stats:", error);
                      }
                  });
                  
                  
                  
                  });
                  
               </script>
               <!-- END JS for stats -->
               <!-- END DOCKER SERVICES -->
               <!-- STORAGE -->
               <div x-show="activeTab === 'storage'" x-cloak>

<!-- Loading and Error messages for df -->
<template x-if="loading">
  <div
    x-data="{
      messages: [
        'Loading storage information...',
        'Fetching data from server...',
        'Almost there, please wait...',
        'Preparing your dashboard...',
        'Why is this taking so long...',
        'Its taking forever, refresh and try again...'
      ],
      messageIndex: 0,
      get message() { return this.messages[this.messageIndex]; },
      interval: null,
      startRotating() {
        // Show the first message after 1s, then next message after each +1s (2s, 3s, etc)
        let delay = 1000;
        const showNext = () => {
          if (this.messageIndex < this.messages.length - 1) {
            this.messageIndex++;
            delay += 1000;
            this.interval = setTimeout(showNext, delay);
          } else {
            // Stop rotating at the last message
            this.stopRotating();
          }
        };
        this.interval = setTimeout(showNext, delay);
      },
      stopRotating() {
        if (this.interval) clearTimeout(this.interval);
      }
    }"
    x-init="startRotating()"
    x-on:remove="stopRotating()"
    style="
      font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji';
      height: 90vh;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    "
    class="p-6 h-72 w-full flex flex-col items-center justify-center text-center text-gray-500 dark:text-gray-400"
  >
    <svg
      class="animate-spin h-8 w-8 text-gray-400 dark:text-gray-600"
      xmlns="http://www.w3.org/2000/svg"
      fill="none" viewBox="0 0 24 24"
    >
      <circle
        class="opacity-25"
        cx="12" cy="12" r="10"
        stroke="currentColor" stroke-width="4"
      ></circle>
      <path
        class="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
      ></path>
    </svg>

    <p class="mt-3 font-medium text-gray-900 dark:text-gray-50" x-text="message"></p>
  </div>
</template>


<template x-if="error">
    <div class="text-red-600" x-text="error"></div>
</template>

<template x-if="!loading && !error">

    <div>
        <!-- Combined Table Format -->
        <table class="w-full caption-bottom border-b border-gray-200 dark:border-gray-800">
            <thead>
                <tr class="sm:[&_td:last-child]:pr-6 sm:[&_th:last-child]:pr-6 sm:[&_td:first-child]:pl-6 sm:[&_th:first-child]:pl-6">
                    <th class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Name/ID</th>
                    <th class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Details</th>
                    <th class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Size</th>
                    <th class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Used By</th>
                    <th class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Status</th>
                    <th class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Type</th>

                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
                <!-- Volumes -->
                <tr>
                    <th class="whitespace-nowrap border-b px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 bg-gray-50 py-3 pl-4 sm:pl-6 dark:bg-gray-900" scope="colgroup" colspan="6">
                        <div class="flex gap-1 items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-database" viewBox="0 0 16 16">
  <path d="M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"/>
</svg> Volumes
                        <span class="ml-2 font-medium text-gray-600 dark:text-gray-400" x-text="volumes.length"></span>
                    </div>
                    </th>
                </tr>
                <template x-for="v in volumes" :key="'volume-' + v.Name">
                    <tr>
                        <td 
                        class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400 relative"
                        x-bind:title="v.Name"
                        x-text="v.Name.length > 20 ? v.Name.slice(0, 20) + '...' : v.Name"
                        ></td>
                        <td class="text-xs whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400 space-y-1">
                            <div class="flex items-center gap-1">Mountpoint: <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="orange" class="bi bi-folder-fill" viewBox="0 0 16 16"><path d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.825a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3m-8.322.12q.322-.119.684-.12h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981z"></path></svg> <span class="font-medium text-gray-900 dark:text-gray-50" x-text="v.Mountpoint"></span></div>

                            <div>Type: <span class="font-medium text-gray-900 dark:text-gray-50" x-text="v.Driver"></span></div>

<div x-data="{
    showAll: false,
    get mainLabels() {
        // Only purpose and description
        return this.v.Labels.split(',')
            .filter(l => l.startsWith('purpose=') || l.startsWith('description='));
    },
    get otherLabels() {
        // All except purpose and description
        return this.v.Labels.split(',')
            .filter(l => !(l.startsWith('purpose=') || l.startsWith('description=')));
    },
    formatLabel(label) {
        const [key, ...rest] = label.split('=');
        // Capitalize first letter and replace '-' with space if needed
        const name = key.charAt(0).toUpperCase() + key.slice(1);
        return name + ': ' + rest.join('=');
    }
}">
  <ul>
    <template x-for="label in mainLabels" :key="label">
      <li x-text="formatLabel(label)"></li>
    </template>
  </ul>

  <template x-if="otherLabels.length">
    <div>
      <a href="#" @click.prevent="showAll = !showAll" class="text-blue-600 underline">
        <span x-text="showAll ? 'Hide all labels' : 'Show all labels'"></span>
      </a>
      <div x-show="showAll" class="mt-2">
        <ul>
          <template x-for="label in otherLabels" :key="label">
            <li x-text="label"></li>
          </template>
        </ul>
      </div>
    </div>
  </template>
</div>

                        </td>

                        <td class="whitespace-nowrap p-4 font-medium text-gray-900 dark:text-gray-50" x-text="v.Size"></td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                            <span x-text="v.Links"></span> containers
                        </td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                        </td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400"> Volume</td>
                    </tr>
                </template>
                <!-- Containers -->
                <tr>

                    <th class="whitespace-nowrap border-b px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 bg-gray-50 py-3 pl-4 sm:pl-6 dark:bg-gray-900" scope="colgroup" colspan="6">
                        <div class="flex gap-1 items-center">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
  <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
</svg> Containers
                        <span class="ml-2 font-medium text-gray-600 dark:text-gray-400" x-text="containers.length"></span>
                        </div>
                    </th>
                </tr>
                <template x-for="c in containers" :key="'container-' + c.ID">
                    <tr>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400" x-text="c.Names"></td>
                        <td class="text-xs whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400 space-y-1">
                            <div>ID: <span x-text="c.ID"></span></div>
                            <div>Image: <span class="font-medium text-gray-900 dark:text-gray-50" x-text="c.Image"></span></div>
                            <div>Status: <span class="font-medium text-gray-900 dark:text-gray-50" x-text="c.Status"></span></div>
                            <div class="hidden">Running For: <span x-text="c.RunningFor"></span></div>
                            <div>Ports: <span class="font-medium text-gray-900 dark:text-gray-50" x-text="c.Ports"></span></div>

<div class="flex">

    <div class="w-1/2">
        Networks:
        <ul class="list-inside space-y-1" x-show="c.Networks && c.Networks.split(',').filter(Boolean).length">
            <template x-for="network in c.Networks.split(',').filter(Boolean)" :key="network">
                <li class="flex items-center gap-1">
                    <template x-if="network.trim().endsWith('_www')">
                        <!-- Globe icon SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-globe" viewBox="0 0 16 16">
                            <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7.5-6.923c-.67.204-1.335.82-1.887 1.855A8 8 0 0 0 5.145 4H7.5zM4.09 4a9.3 9.3 0 0 1 .64-1.539 7 7 0 0 1 .597-.933A7.03 7.03 0 0 0 2.255 4zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a7 7 0 0 0-.656 2.5zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5zM8.5 5v2.5h2.99a12.5 12.5 0 0 0-.337-2.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5zM5.145 12q.208.58.468 1.068c.552 1.035 1.218 1.65 1.887 1.855V12zm.182 2.472a7 7 0 0 1-.597-.933A9.3 9.3 0 0 1 4.09 12H2.255a7 7 0 0 0 3.072 2.472M3.82 11a13.7 13.7 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5zm6.853 3.472A7 7 0 0 0 13.745 12H11.91a9.3 9.3 0 0 1-.64 1.539 7 7 0 0 1-.597.933M8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855q.26-.487.468-1.068zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.7 13.7 0 0 1-.312 2.5m2.802-3.5a7 7 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7 7 0 0 0-3.072-2.472c.218.284.418.598.597.933M10.855 4a8 8 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4z"/>
                        </svg>
                    </template>
                    <template x-if="network.trim().endsWith('_db')">
                        <!-- Database icon SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-database-fill" viewBox="0 0 16 16">
                            <path d="M3.904 1.777C4.978 1.289 6.427 1 8 1s3.022.289 4.096.777C13.125 2.245 14 2.993 14 4s-.875 1.755-1.904 2.223C11.022 6.711 9.573 7 8 7s-3.022-.289-4.096-.777C2.875 5.755 2 5.007 2 4s.875-1.755 1.904-2.223"/>
                            <path d="M2 6.161V7c0 1.007.875 1.755 1.904 2.223C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777C13.125 8.755 14 8.007 14 7v-.839c-.457.432-1.004.751-1.49.972C11.278 7.693 9.682 8 8 8s-3.278-.307-4.51-.867c-.486-.22-1.033-.54-1.49-.972"/>
                            <path d="M2 9.161V10c0 1.007.875 1.755 1.904 2.223C4.978 12.711 6.427 13 8 13s3.022-.289 4.096-.777C13.125 11.755 14 11.007 14 10v-.839c-.457.432-1.004.751-1.49.972-1.232.56-2.828.867-4.51.867s-3.278-.307-4.51-.867c-.486-.22-1.033-.54-1.49-.972"/>
                            <path d="M2 12.161V13c0 1.007.875 1.755 1.904 2.223C4.978 15.711 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13v-.839c-.457.432-1.004.751-1.49.972-1.232.56-2.828.867-4.51.867s-3.278-.307-4.51-.867c-.486-.22-1.033-.54-1.49-.972"/>
                        </svg>
                    </template>
                    <template x-if="!network.trim().endsWith('_www') && !network.trim().endsWith('_db')">
                        <!-- Generic network icon SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hdd-network" viewBox="0 0 16 16">
                            <path d="M4.5 5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M3 4.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
                            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2H8.5v3a1.5 1.5 0 0 1 1.5 1.5h5.5a.5.5 0 0 1 0 1H10A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5H.5a.5.5 0 0 1 0-1H6A1.5 1.5 0 0 1 7.5 10V7H2a2 2 0 0 1-2-2zm1 0v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1m6 7.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5"/>
                        </svg>
                    </template>
                    <span class="font-medium text-gray-900 dark:text-gray-50" x-text="network.trim()"></span>
                </li>
            </template>
        </ul>
        <span x-show="!c.Networks || !c.Networks.split(',').filter(Boolean).length" class="text-gray-400">None</span>
    </div>

    <div class="w-1/2">
        Mounts:
        <ul class="list-inside space-y-1" x-show="c.Mounts && c.Mounts.split(',').filter(Boolean).length">
            <template x-for="mount in c.Mounts.split(',').filter(Boolean)" :key="mount">
                <li class="flex items-center gap-1">
                    <template x-if="(() => {
                        let parts = mount.trim().split('/');
                        let last = parts[parts.length - 1];
                        return last.includes('.');
                    })()">
                        <!-- File icon SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-fill" viewBox="0 0 16 16">
                            <path d="M9.293 0H1a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.707a1 1 0 0 0-.293-.707l-5.414-5.414A1 1 0 0 0 11.293 0H9.293zM9 1.5v4A1.5 1.5 0 0 0 10.5 7H15v7a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h7z"/>
                        </svg>
                    </template>
                    <template x-if="!(() => {
                        let parts = mount.trim().split('/');
                        let last = parts[parts.length - 1];
                        return last.includes('.');
                    })()">
                        <!-- Folder icon SVG -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="orange" class="bi bi-folder-fill" viewBox="0 0 16 16">
                            <path d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.825a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3m-8.322.12q.322-.119.684-.12h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981z"></path>
                        </svg>
                    </template>
                    <span class="font-medium text-gray-900 dark:text-gray-50" x-text="mount.trim()"></span>
                </li>
            </template>
        </ul>
        <span x-show="!c.Mounts || !c.Mounts.split(',').filter(Boolean).length" class="text-gray-400">None</span>
    </div>

</div>


<div>
  Command:
  <div class="w-80 overflow-x-auto bg-gray-100 dark:bg-gray-900 rounded p-2 my-2">
    <code class="break-words whitespace-pre-wrap" x-text="c.Command">
    </code>
  </div>
</div>





<div x-data="{
    showAll: false,
    get allLabels() {
        return this.c.Labels.split(',').filter(l => l.trim().length);
    }
}">
  <span>
    Labels:
    <template x-if="allLabels.length">
      <a href="#" @click.prevent="showAll = !showAll" class="text-blue-600 underline ml-2">
        <span x-text="showAll ? 'Hide all labels' : 'Show all labels'"></span>
      </a>
    </template>
  </span>
  <template x-if="allLabels.length">
    <div x-show="showAll" class="mt-2">
      <ul>
        <template x-for="label in allLabels" :key="label">
          <li x-text="label"></li>
        </template>
      </ul>
    </div>
  </template>
</div>

                        </td>
                        <td class="whitespace-nowrap p-4 font-medium text-gray-900 dark:text-gray-50" x-text="c.Size"></td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                            <span x-text="c.LocalVolumes"></span> volumes
                        </td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                            <span class="inline-flex items-center gap-x-1 whitespace-nowrap px-2 py-1 text-xs font-medium ring-1 ring-inset bg-emerald-50 text-emerald-900 ring-emerald-600/30 dark:bg-emerald-400/10 dark:text-emerald-400 dark:ring-emerald-400/20 rounded-full">
                                <span class="size-1.5 shrink-0 rounded-full bg-emerald-600 dark:bg-emerald-400" aria-hidden="true"></span>
                                <span x-text="c.State"></span>
                            </span>
                        </td>

                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400"> Container</td>


                    </tr>
                </template>
                <!-- Images -->
                <tr>


                    <th class="whitespace-nowrap border-b px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 bg-gray-50 py-3 pl-4 sm:pl-6 dark:bg-gray-900" scope="colgroup" colspan="6">
                        <div class="flex gap-1 items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
                        <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"/>
                        </svg> Images
                                                <span class="ml-2 font-medium text-gray-600 dark:text-gray-400" x-text="images.length"></span>
                        </div>
                    </th>
                </tr>
                <template x-for="img in images" :key="'image-' + img.ID">
                    <tr>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400" x-text="img.Repository + (img.Tag && img.Tag !== '<none>' ? ':' + img.Tag : '')"></td>
                        <td class="text-xs whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400 space-y-1">
                            <div>ID: <span x-text="img.ID"></span></div>
                            <div class="hidden">Tag: <span x-text="img.Tag"></span></div>
                            <div class="hidden">Repository: <span x-text="img.Repository"></span></div>
                            <div>Created: <span x-text="img.CreatedAt"></span></div>


                            <div>Labels: <span x-text="img.Labels"></span></div>



                            <div>Created since: <span class="font-medium text-gray-900 dark:text-gray-50" x-text="img.CreatedSince"></span></div>
                        </td>
                        <td class="whitespace-nowrap p-4 font-medium text-gray-900 dark:text-gray-50" x-text="img.Size"></td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                            <span x-text="img.Containers"></span> containers
                        </td>
                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                        </td>


                        <td class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">Image</td>


                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</template>


               </div>
               <!-- END STORAGE -->

               <!-- INFO -->
               <div x-show="activeTab === 'info'" class="p-4" x-cloak>
                  <div class="grid grid-cols-2 gap-4">
                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">User ID:</span><span class="font-medium">{{user.id}}</span></div>
                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Email address:</span><span class="font-medium">{{user.email}}</span></div>
                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">IP address:</span><span class="font-medium flex"> {{server_ip}}<span class="hidden sm:flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-gray-50 text-gray-800 ring-gray-600/30 dark:bg-gray-400/10 dark:text-gray-500 dark:ring-gray-400/20 ml-1">{{ip_type}}</span></span></div>
                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Geo Location:</span><span class="flex items-center font-medium">
                        {% if country_name %}{{country_name}}{% elif country_code %}<img  class="w-4 h-4 rounded mr-1" src="/static/dist/img/flags/{{country_code.lower()}}.svg" alt="IP address location: {{country_code}}"></img>{% endif %} ({{country_code}})</span></div>


                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Server:</span><span class="font-medium">{{server_name}}</span></div>

                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Docker Context:</span><span class="font-medium">{{docker_context}}</span></div>




                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">2FA status:</span><span class="font-medium">{% if user.twofa_enabled  == 1 %}<span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-emerald-50 text-emerald-800 ring-emerald-600/30 dark:bg-emerald-400/10 dark:text-emerald-400 dark:ring-emerald-400/20">Active</span>>{% elif user.twofa_enabled  == 0 %}<span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-yellow-50 text-yellow-800 ring-yellow-600/30 dark:bg-yellow-400/10 dark:text-yellow-500 dark:ring-yellow-400/20">Inactive</span>{% else %}<span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-gray-50 text-gray-800 ring-gray-600/30 dark:bg-gray-400/10 dark:text-gray-500 dark:ring-gray-400/20">Unknown</span>{% endif %}</span></div>
                     {% if user.owner %}
                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Reseller:</span><span class="font-medium"><a href="/resellers">{{user.owner}}</a></span></div>
                     {% endif %}
                     <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Setup time:</span><span class="font-medium">{{ user.registered_date.strftime('%d.%m.%Y %H:%M:%S') }}</span></div>


{% if "SUSPENDED_" in user.username %}
  {% set datetime_str = user.username.split('_')[1] %}
  {% set year = datetime_str[0:4] %}
  {% set month = datetime_str[4:6] %}
  {% set day = datetime_str[6:8] %}
  {% set hour = datetime_str[8:10] %}
  {% set minute = datetime_str[10:12] %}
  <div class="flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-800/50"><span class="text-sm capitalize text-gray-600 dark:text-gray-400">Suspended on:</span><span class="font-medium">{{ day }}.{{ month }}.{{ year }} {{ hour }}:{{ minute }}</span></div>
{% endif %}




                  </div>
                  <br>
                  <div class="flex flex-col gap-2 text-center sm:flex-row sm:items-center sm:justify-between sm:text-start pb-2">
                  <span class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium">Custom message for user:</span> <button type="button" class="hidden sm:flex save_custom_message_btn relative  items-center justify-center rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out cursor-pointer outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit border-black bg-black text-white hover:bg-gray-800 sm:mt-0">Save</button>
                  </div>
                  <textarea id="custom_message_for_this_user" class="flex min-h-[4rem] w-full rounded-md border px-3 py-1.5 shadow-sm outline-none transition-colors sm:text-sm text-gray-900 dark:text-gray-50 border-gray-300 dark:border-gray-800 bg-white dark:bg-gray-950 placeholder-gray-400 dark:placeholder-gray-500 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-300 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700" rows="5"></textarea>
                  
<button type="button" class="w-full mt-2 sm:hidden save_custom_message_btn relative inline-flex items-center justify-center rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out cursor-pointer outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit border-black bg-black text-white hover:bg-gray-800 sm:mt-0">Save</button>

<script>
  const textarea = document.getElementById('custom_message_for_this_user');
  const saveBtn = document.querySelector('.save_custom_message_btn');
  var csrf_token = $('meta[name="csrf-token"]').attr('content');

  async function saveCustomMessage() {
    const message = textarea.value;

    try {
      const response = await fetch(`/get_custom_message_for_user/${username}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrf_token,
          'Accept': 'application/json',
        },
        body: JSON.stringify({ custom_message: message }),
      });

      if (response.ok) {
        const data = await response.json();
        showToast(data.message || 'Saved successfully.', 'info');
      } else {
        const errorData = await response.json();
        showToast(errorData.error || `Save failed (${response.status})`, 'error');
      }
    } catch (err) {
      showToast('Error saving custom message for user.', 'error');

    }
  }

  saveBtn.addEventListener('click', () => {
    saveCustomMessage();
  });
</script>




                  <br>
               </div>
               <!-- INFO -->
               <!-- EDIT -->
               <div x-show="activeTab === 'edit'" class="p-4" x-cloak>
                  <form action="/user/edit/{{ user.username.split('_')[-1] }}" method="POST">
                     <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                     <div id="collapseAddNewUser">
                        <div id="create_user_form" class="sm:mx-auto sm:max-w-4xl">
                  <form id="userForm" class="mt-8">
                  <div class="grid grid-cols-1 gap-4 sm:grid-cols-6">
                  <div class="col-span-full sm:col-span-3">
                  <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="admin_username">Username</label>
                  <div class="relative w-full mt-2">
                  <input
                     type="text"
                     class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-none focus:outline-none disabled:pointer-events-none file:disabled:pointer-events-none file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100 file:dark:border-gray-800 file:dark:bg-gray-950 file:hover:dark:bg-gray-900/20 file:disabled:dark:border-gray-700 file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem] file:disabled:bg-gray-100 file:disabled:text-gray-500 file:disabled:dark:bg-gray-800 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 [&amp;::-webkit-search-cancel-button]:hidden [&amp;::-webkit-search-decoration]:hidden" min="5" max="16"  minlength="5" maxlength="16" pattern="[a-zA-Z0-9]{3,16}" title="Can only contain letters and numbers. 3 characters min. - 16 max." name="new_username" placeholder="Username" value="{{ user.username.split('_')[-1] }}"/>
                  </div>
                  </div>
                  <div class="col-span-full sm:col-span-3">
                  <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="admin_email">Email address</label>
                  <div class="relative w-full mt-2">
                  <input
                  type="email" 
                  class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-none focus:outline-none disabled:pointer-events-none file:disabled:pointer-events-none file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100 file:dark:border-gray-800 file:dark:bg-gray-950 file:hover:dark:bg-gray-900/20 file:disabled:dark:border-gray-700 file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem] file:disabled:bg-gray-100 file:disabled:text-gray-500 file:disabled:dark:bg-gray-800 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 [&amp;::-webkit-search-cancel-button]:hidden [&amp;::-webkit-search-decoration]:hidden" autocomplete="email" name="new_email" placeholder="some-email@example.com" autocomplete="off" value="{{ user.email }}"
                  </div>
                  </div>
                  </div>
                  <div x-data="passwordManager()" class="col-span-full">
                  <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="admin_password">Password
                  </label>
                  <div class="relative w-full flex mt-2">
                  <input 
                     x-ref="passwordInput" 
                     x-bind:type="passwordVisible ? 'text' : 'password'" 
                     x-model="password" 
                     class="relative block w-full appearance-none border px-2.5 py-2 shadow-sm outline-none rounded-l transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-none focus:outline-none disabled:pointer-events-none file:disabled:pointer-events-none file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100 file:dark:border-gray-800 file:dark:bg-gray-950 file:hover:dark:bg-gray-900/20 file:disabled:dark:border-gray-700 file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem] file:disabled:bg-gray-100 file:disabled:text-gray-500 file:disabled:dark:bg-gray-800 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 [&amp;::-webkit-search-cancel-button]:hidden [&amp;::-webkit-search-decoration]:hidden"
                     autocomplete="password" 
                     name="new_password" 
                     minlength="6" 
                     maxlength="30" 
                     pattern="[^']{6,30}" 
                     title="Can not contain apostrophe. 6 characters min. - 30 max." 
                     placeholder="unchanged if empty"
                     />
                  <div class="flex">
                  <button 
                     @click="generatePassword()" 
                     class="relative inline-flex items-center justify-center border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out cursor-pointer outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit border-black bg-black text-white hover:bg-gray-800 sm:mt-0" 
                     type="button" 
                     id="generatePassword" 
                     tabindex="-1"
                     >
                  Generate
                  </button>
                  <button 
                     @click="togglePasswordVisibility()" 
                     class="relative inline-flex items-center justify-center rounded-r border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out cursor-pointer outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit border-black bg-black text-white hover:bg-gray-800 sm:mt-0" 
                     tabindex="-1" 
                     type="button" 
                     id="togglePassword"
                     >
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="margin:0;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-eye">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                  <path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                  </svg>
                  </button>
                  </div>
                  </div>
                  </div>


                <script>
                    function passwordManager() {
                        return {
                            password: '',
                            passwordVisible: false,
                            generatePassword() {
                                const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
                                let result = "";
                                for (let i = 0; i < 16; i++) {
                                    const randomIndex = Math.floor(Math.random() * charset.length);
                                    result += charset.charAt(randomIndex);
                                }
                                this.password = result;
                                this.passwordVisible = true;  // Make password visible immediately after generating
                                this.$nextTick(() => {
                                    this.$refs.passwordInput.focus();
                                });
                            },
                            togglePasswordVisibility() {
                                this.passwordVisible = !this.passwordVisible;
                            }
                        };
                    }
                </script>



                  <div class="mx-auto my-6 flex w-full items-center justify-between gap-3 text-sm text-gray-500 dark:text-gray-500 col-span-full"><div class="h-[1px] w-full bg-gray-200 dark:bg-gray-800"></div></div>
                  <div class="col-span-full sm:col-span-3">
                  <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="new_ip">IP address</label>
                  <div class="relative w-full mt-2">
                  <select class="group/trigger flex w-full select-none items-center justify-between gap-2 truncate rounded-md border px-3 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 data-[placeholder]:text-gray-500 data-[placeholder]:dark:text-gray-500 bg-white dark:bg-gray-950 hover:bg-gray-50 hover:dark:bg-gray-950/50 data-[disabled]:bg-gray-100 data-[disabled]:text-gray-400 data-[disabled]:dark:border-gray-700 data-[disabled]:dark:bg-gray-800 data-[disabled]:dark:text-gray-500 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 mt-2" id="ipSelect" name="new_ip" disabled>
                  <option disabled value="">Change IP address</option>
                  </select>
                  </div>
                  </div>
                  <div class="hidden col-span-full sm:col-span-3">
                  <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="size">MySQL type</label>
                  <select class="group/trigger flex w-full select-none items-center justify-between gap-2 truncate rounded-md border px-3 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 data-[placeholder]:text-gray-500 data-[placeholder]:dark:text-gray-500 bg-white dark:bg-gray-950 hover:bg-gray-50 hover:dark:bg-gray-950/50 data-[disabled]:bg-gray-100 data-[disabled]:text-gray-400 data-[disabled]:dark:border-gray-700 data-[disabled]:dark:bg-gray-800 data-[disabled]:dark:text-gray-500 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 mt-2" name="sql_type" id="sql_type">
                  <option disabled selected value> -- select sql server -- </option>
                  <option value="mysql">MySQL</option>
                  <option value="mariadb">MariaDB</option>
                  </select>
                  </div>
                  <div class="mx-auto my-6 flex w-full items-center justify-between gap-3 text-sm text-gray-500 dark:text-gray-500 col-span-full"><div class="h-[1px] w-full bg-gray-200 dark:bg-gray-800"></div></div>
                  <div class="col-span-full">
                  <div role="radiogroup" aria-required="false" dir="ltr" class="grid gap-2" tabindex="0" style="outline: none;">
                  <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">Select a package</p>
                  <div x-data="{ selectedPlan: '{{ user.plan_id }}' }" class="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-3">
                  {% for plan in plans %}
                  <button type="button" role="radio" 
                     :aria-checked="selectedPlan === '{{ plan.id }}' ? 'true' : 'false'" 
                     :data-state="selectedPlan === '{{ plan.id }}' ? 'checked' : ''" 
                     value="{{ plan.name }}" 
                     class="group relative w-full rounded-md border p-4 text-left shadow-sm transition focus:outline-none bg-white dark:bg-gray-950 border-gray-300 dark:border-gray-800 data-[state=checked]:border-blue-500 data-[state=checked]:dark:border-blue-500 data-[disabled]:border-gray-100 data-[disabled]:dark:border-gray-800 data-[disabled]:bg-gray-50 data-[disabled]:shadow-none data-[disabled]:dark:bg-gray-900 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 flex items-start justify-between" 
                     :id="plan.id" tabindex="0"
                     @click="selectedPlan = '{{ plan.id }}'">
                  <div x-show="'{{ plan.id }}' === '{{ user.plan_id }}'" class="absolute -top-3 flex"><span class="inline-flex items-center rounded-full bg-gray-300 text-black text-xs font-semibold py-1 px-3">Current Plan</span></div>
                  <div class="flex w-full flex-col justify-between">
                  <div>
                  <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium" for="{{ plan.id }}" aria-describedby="{{ plan.id }}-description">
                  {{ plan.name }}
                  </label>
                  <p class="mt-1 text-sm text-gray-500 dark:text-gray-500">{{ plan.description }}</p>
                  </div>
                  <div class="mt-4" x-data="{ showDetails: false }">
                  <span @click="showDetails = !showDetails" class="text-sm font-medium text-gray-900 dark:text-gray-50">Display Limits</span>
                  <span :class="{ 'hidden': !showDetails }">

<p class="mt-6 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.cpu == 0 or plan.cpu == '0' else plan.cpu }} Cores
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.ram|lower == '0g' or plan.ram == 0 else plan.ram }} Memory
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.disk_limit == '0 GB' else plan.disk_limit }} Storage
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.inodes_limit == 0 else plan.inodes_limit }} Inodes
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.bandwidth == 0 else plan.bandwidth }} Mbps
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.domains_limit == 0 else plan.domains_limit }} Domains
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.websites_limit == 0 else plan.websites_limit }} Websites
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.email_limit == 0 else plan.email_limit }} Email accounts
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.ftp_limit == 0 else plan.ftp_limit }} FTP accounts
</p>

<p class="mt-1 text-xs text-gray-500 dark:text-gray-500">
  {{ '∞' if plan.db_limit == 0 else plan.db_limit }} MySQL Databases
</p>
                  </span>
                  </div>
                  </div>
                  <div class="relative flex size-4 shrink-0 appearance-none items-center justify-center rounded-full border shadow-sm border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 group-data-[state=checked]:border-0 group-data-[state=checked]:border-transparent group-data-[state=checked]:bg-blue-500 group-data-[disabled]:border-gray-300 group-data-[disabled]:bg-gray-100 group-data-[disabled]:text-gray-400 group-data-[disabled]:dark:border-gray-700 group-data-[disabled]:dark:bg-gray-800 outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500">
                  <span x-show="selectedPlan === '{{ plan.id }}'" class="flex items-center justify-center">
                  <div class="size size-1.5 shrink-0 rounded-full bg-white group-data-[disabled]:bg-gray-400 group-data-[disabled]:dark:bg-gray-500"></div>
                  </span>
                  </div>
                  </button>
                  <!-- Hidden radio input to track the selected plan -->
                  <input type="radio" value="{{ plan.id }}" aria-hidden="true" style="transform: translateX(-100%); position: absolute; pointer-events: none; opacity: 0; margin: 0px; width: 213.328px; height: 146px;" tabindex="-1" name="plan_id" :checked="selectedPlan === '{{ plan.id }}'" />
                  {% endfor %}
                  </div>
                  </div>
                  </div>
                  </div>
                  <div class="mx-auto my-6 flex w-full items-center justify-between gap-3 text-sm text-gray-500 dark:text-gray-500"><div class="h-[1px] w-full bg-gray-200 dark:bg-gray-800"></div></div>
                  <div class="flex items-center justify-end space-x-4">
                  <a href="/users" class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 bg-white dark:bg-gray-950 hover:bg-gray-50 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600">Go back</a>
                  <button type="submit" class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-transparent text-white dark:text-white bg-blue-500 dark:bg-blue-500 hover:bg-blue-600 dark:hover:bg-blue-600 disabled:bg-blue-300 disabled:text-white disabled:dark:bg-blue-800 disabled:dark:text-blue-400">Save</button>
                  </div>
                  </form>
                  </div>
               </div>
               </form>
            </div>
            <!-- END EDIT -->
            <!-- ACTIVITY -->
            <div x-show="activeTab === 'activity'" x-cloak x-data="{ searchQuery: '' }">
               <!-- Search Input -->
               <div class="flex flex-col justify-between gap-2 px-4 py-6 sm:flex-row sm:items-center sm:p-6">
                  <div class="relative w-full sm:w-64 [&>input]:py-1.5">
                     <input
                        x-model="searchQuery"
                        class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-none focus:outline-none disabled:pointer-events-none file:disabled:pointer-events-none file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100 file:dark:border-gray-800 file:dark:bg-gray-950 file:hover:dark:bg-gray-900/20 file:disabled:dark:border-gray-700 file:[border-inline-end-width:1px] file:[margin-inline-end:0.75rem] file:disabled:bg-gray-100 file:disabled:text-gray-500 file:disabled:dark:bg-gray-800 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 [&amp;::-webkit-search-cancel-button]:hidden [&amp;::-webkit-search-decoration]:hidden pl-8"
                        placeholder="Search activities..."
                        type="search"
                        />
                     <div class="pointer-events-none absolute bottom-0 left-2 flex h-full items-center justify-center text-gray-400 dark:text-gray-600">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-[1.125rem] shrink-0">
                           <path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path>
                        </svg>
                     </div>
                  </div>
               </div>
               <div class="overflow-x-auto">
                  <div class="w-full overflow-auto whitespace-nowrap border-t border-gray-200 dark:border-gray-800">
                     <table class="w-full caption-bottom border-b border-gray-200 dark:border-gray-800">
                        <thead>
                           <tr class="whitespace-nowrap border-b px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 bg-gray-50 py-3 pl-4 sm:pl-6 dark:bg-gray-900">
                              <th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Date</th>
                              <th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">Action</th>
                              <th scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-end text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800">IP Address</th>
                           </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
                           <template x-if="$store.activityStore.activities.length === 0">
                              <tr>
                                 <td colspan="12" class="p-6 text-center">
                                    Loading user activity log..
                                 </td>
                              </tr>
                           </template>
                           <template x-for="(activity, index) in $store.activityStore.activities.filter(activity => {
                              return activity.date.toLowerCase().includes(searchQuery.toLowerCase()) || 
                              activity.action.toLowerCase().includes(searchQuery.toLowerCase()) || 
                              activity.ip.toLowerCase().includes(searchQuery.toLowerCase());
                              })" :key="activity.timestamp + '-' + index">
                              <tr :class="activity.actionClass" 
                                 class="domain_row sm:[&_td:last-child]:pr-6 sm:[&_td:first-child]:pl-6 hover:bg-white dark:hover:bg-gray-900">
                                 <td class="relative group cursor-pointer p-4 text-sm relative whitespace-nowrap py-2.5 text-gray-600 dark:text-gray-400 text-left" 
                                    x-text="activity.date"></td>
                                 <td class="flex items-center relative group cursor-pointer p-4 text-sm relative whitespace-nowrap py-2.5 text-gray-600 dark:text-gray-400 text-left truncate max-w-[100px]" 
                                    x-html="activity.action"></td>
                                 <td class="relative group cursor-pointer p-4 text-sm relative whitespace-nowrap py-2.5 text-gray-600 dark:text-gray-400 text-end" 
                                    x-text="activity.ip"></td>
                              </tr>
                           </template>
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
            <!-- END ACTIVITY -->
            <!-- SUSPEND USER -->
            <div x-show="activeTab === 'suspend'" class="p-4" x-cloak>
               <form method="POST" action="/user/suspend/{{ user.username.split('_')[-1] }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <div x-data="{ confirmationText: '' }" class="relative w-full p-6 text-left shadow-sm bg-white dark:bg-[#090E1A] border-gray-200 dark:border-gray-900 sm:mx-auto sm:max-w-xl">
               <form action="#" method="POST">
               <h3 class="font-semibold text-gray-900 dark:text-gray-50">Suspend user account</h3>
               <p class="mt-1 text-sm/6 text-gray-500 dark:text-gray-500">Disable login for OpenPanel user, stop their services and revoke access to websites and emails.</p>
               <div class="mt-6">
               <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium">Type "{{ user.username.split('_')[-1] }}" to confirm:</label>
               <div class="relative w-full mt-2">
               <input type="text" x-model="confirmationText" class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950">
               </div>
               </div>
               <button x-show="confirmationText === '{{ user.username.split('_')[-1] }}'" x-cloak class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 border-transparent text-white dark:text-white bg-blue-500 dark:bg-blue-500 hover:bg-blue-600 dark:hover:bg-blue-600 disabled:bg-blue-300 disabled:text-white disabled:dark:bg-blue-800 disabled:dark:text-blue-400 mt-4 w-full" type="submit">Suspend account</button>
               </form>
               </div>
               </form>
            </div>
            <!-- END SUSPEND USER -->
            <!-- DELETE USER -->
            <div x-show="activeTab === 'delete'" class="p-4" x-cloak>
               <form method="POST" action="/user/delete/{{ user.username.split('_')[-1] }}">
                  <div x-data="{ confirmationText: '' }" class="relative w-full p-6 text-left shadow-sm bg-white dark:bg-[#090E1A] border-gray-200 dark:border-gray-900 sm:mx-auto sm:max-w-xl">
               <form action="#" method="POST">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
               <h3 class="font-semibold text-gray-900 dark:text-gray-50">Delete user account</h3>
               <p class="mt-1 text-sm/6 text-gray-500 dark:text-gray-500">All user data will be permanently deleted. There is no coming back after you press delete.</p>
               <div class="mt-6">
               <label class="text-sm leading-none text-gray-900 dark:text-gray-50 font-medium">Type "{{ user.username.split('_')[-1] }}" to confirm:</label>
               <div class="relative w-full mt-2">
               <input type="text" x-model="confirmationText" class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950">
               </div>
               </div>
               <button x-show="confirmationText === '{{ user.username.split('_')[-1] }}'" x-cloak class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 text-white border-transparent bg-red-600 dark:bg-red-700 hover:bg-red-700 dark:hover:bg-red-600 mt-4 w-full" type="submit">Delete account permanently</button>
               </form>
               </div>
               </form>
            </div>
            <!-- END DELETE USER -->
         </div>
      </div>
   </div>
</div>


{% else %}



<div
    style="
        font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji';
        height: 90vh;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    "
>
    <div>
        <style>
            body {
                color: #000;
                background: #fff;
                margin: 0;
            }
            .next-error-h1 {
                border-right: 1px solid rgba(0, 0, 0, 0.3);
            }
            @media (prefers-color-scheme: dark) {
                body {
                    color: #fff;
                    background: #000;
                }
                .next-error-h1 {
                    border-right: 1px solid rgba(255, 255, 255, 0.3);
                }
            }
        </style>
        <div style="display: inline-block;">
          <h2 style="scroll-mt-10 font-semibold text-gray-900 dark:text-gray-50">No such user</h2>
          <p class="mt-1 text-sm leading-6 text-gray-500">This user no longer exists or MySQL database is unreachable.</p>
          </div>
    </div>
</div>


{% endif %}







{% endblock %}
