{% extends 'base.html' %}
{% block content %}


{% if json_logs %}
<!-- page header -->
<div aria-label="Select Domain Log Header">

    <div x-data="{ showSection: false }" class="border-b border-gray-200 bg-gray-50 p-4 dark:border-gray-800 dark:bg-gray-950 sm:p-6 lg:p-8">
        <header>
            <div class="flex flex-col gap-2 text-center sm:flex-row sm:items-center sm:justify-between sm:text-start">
                <div class="grow">
                    <h1 class="mb-1 text-xl font-bold">Domain Logs for {{ domain_name }}</h1>
                    <h2 class="text-sm font-medium text-slate-500">Showing {{ items_per_page * (current_page - 1) + 1 }} - {% if items_per_page * current_page > total_lines %}{{ total_lines }}{% else %}{{ items_per_page * current_page }}{% endif %} out of {{ total_lines }} rows</h2>
                </div>
                <div class="flex flex-none items-center justify-center gap-2 rounded-sm px-2 sm:justify-end sm:bg-transparent sm:px-0">
    <p class="text-sm text-gray-500 dark:text-gray-500">
        {% if total_lines < total_allowed_lines_for_show_all %}
        <input class="form-check-input" type="checkbox" role="switch" id="showAllCheckbox" {% if show_all %}checked{% endif %}>
        <label class="form-check-label text-secondary fs-sm" for="showAllCheckbox">Show all {{ total_lines }} rows</label>
        {% endif %}
    </p>
                </div>
            </div>
        </header>
    </div>



    <div class="mt-2 gap-2 sm:mt-0 sm:flex">

<script>
    // Script to handle toggling the "Show all activity" checkbox
    const showAllCheckbox = document.getElementById('showAllCheckbox');

    showAllCheckbox.addEventListener('change', () => {
        const urlSearchParams = new URLSearchParams(window.location.search);
        if (showAllCheckbox.checked) 
        {
            urlSearchParams.set('show_all', 'true');
            urlSearchParams.delete('page');// Remove the show_all parameter
        } 
        else 
        {
            urlSearchParams.delete('show_all');// Remove the show_all parameter
        }
        // Update the URL with the new query parameters
        window.location.search = urlSearchParams.toString();
    });


</script>

    </div>
</div>
<!-- END page header -->


<section aria-label="Records Table" x-data="{
    searchQuery: '', 
    columns: {
        timestamp: true,
        level: false,
        logger: false,
        message: false,
        client_ip: true,
        method: true,
        uri: true,
        status: true,
        size: false,
        duration: false
    },
    init() {
        // Load saved column visibility from sessionStorage if available
        const savedColumns = sessionStorage.getItem('columns');
        if (savedColumns) {
            this.columns = JSON.parse(savedColumns);
        }
    },
    saveColumns() {
        // Save the current column visibility to sessionStorage
        sessionStorage.setItem('columns', JSON.stringify(this.columns));
    }
}">
    <div class="flex flex-col justify-between gap-2 px-4 py-6 sm:flex-row sm:items-center sm:p-6">
        <div class="relative w-full sm:w-64 [&>input]:py-1.5">
            <input
                x-model="searchQuery"
                class="relative block w-full appearance-none rounded-md border px-2.5 py-2 shadow-sm outline-none transition sm:text-sm border-gray-300 dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-white dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 file:-my-2 file:-ml-2.5 file:cursor-pointer file:rounded-l-[5px] file:rounded-r-none file:border-0 file:px-3 file:py-2 file:outline-none focus:outline-none disabled:pointer-events-none file:disabled:pointer-events-none file:border-solid file:border-gray-300 file:bg-gray-50 file:text-gray-500 file:hover:bg-gray-100 file:dark:border-gray-800 file:dark:bg-gray-950 file:hover:dark:bg-gray-900/20 file:disabled:dark:border-gray-700 file:disabled:bg-gray-100 file:disabled:text-gray-500 file:disabled:dark:bg-gray-800 focus:ring-2 focus:ring-blue-200 focus:dark:ring-blue-700/30 focus:border-blue-500 focus:dark:border-blue-700 [&::-webkit-search-cancel-button]:hidden [&::-webkit-search-decoration]:hidden pl-8"
                placeholder="Search log..."
                type="search"
            />
            <div class="pointer-events-none absolute bottom-0 left-2 flex h-full items-center justify-center text-gray-400 dark:text-gray-600">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-[1.125rem] shrink-0">
                    <path
                        d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"
                    ></path>
                </svg>
            </div>
        </div>

        <!-- Dropdown for Column Visibility -->
        <div class="relative">
            <button id="dropdownToggleButton" data-dropdown-toggle="dropdownToggle" class="relative inline-flex items-center justify-center rounded-md border px-3 py-2 text-center text-sm font-medium shadow-sm transition-all duration-100 ease-in-out disabled:pointer-events-none disabled:shadow-none outline outline-offset-2 outline-0 focus-visible:outline-2 outline-blue-500 dark:outline-blue-500 dark:border-gray-800 dark:text-gray-50 dark:bg-gray-950 dark:hover:bg-gray-900/60 disabled:text-gray-400 disabled:dark:text-gray-600 sm:w-fit mt-2 w-full sm:w-auto gap-x-1.5 whitespace-nowrap border-black bg-black text-white hover:bg-gray-800 sm:mt-0 cursor-pointer" type="button">Show Columns <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/></svg>
            </button>

            <!-- Dropdown menu -->
            <div id="dropdownToggle" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-72 dark:bg-gray-700 dark:divide-gray-600">
                <ul class="p-3 space-y-1 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownToggleButton">
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.timestamp" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Timestamp</span>
                            </label>
                        </div>
                    </li>
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.level" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Level</span>
                            </label>
                        </div>
                    </li>
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.logger" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Logger</span>
                            </label>
                        </div>
                    </li>
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.message" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Message</span>
                            </label>
                        </div>
                    </li>
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.client_ip" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Client IP</span>
                            </label>
                        </div>
                    </li>


                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.method" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Method</span>
                            </label>
                        </div>
                    </li>

                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.uri" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">URI</span>
                            </label>
                        </div>
                    </li>

                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.status" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Status</span>
                            </label>
                        </div>
                    </li>
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.size" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Size</span>
                            </label>
                        </div>
                    </li>
                    <li>
                        <div class="flex p-2 rounded-sm hover:bg-gray-100 dark:hover:bg-gray-600">
                            <label class="inline-flex items-center w-full cursor-pointer">
                                <input type="checkbox" x-model="columns.duration" x-on:change="saveColumns" class="sr-only peer">
                                <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-500 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"></div>
                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Duration</span>
                            </label>
                        </div>
                    </li>



                </ul>
            </div>
        </div>
    </div>

    <div class="overflow-x-auto">
        <div class="w-full overflow-auto whitespace-nowrap border-t border-gray-200 dark:border-gray-800">
            <table id="databases-table" class="w-full caption-bottom border-b border-gray-200 dark:border-gray-800">
                <thead class="">
                    <tr class="whitespace-nowrap border-b px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 bg-gray-50 py-3 pl-4 sm:pl-6 dark:bg-gray-900">
                        <th x-show="columns.timestamp" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Timestamp</th>
                        <th x-show="columns.level" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Level</th>
                        <th x-show="columns.logger" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Logger</th>
                        <th x-show="columns.message" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Message</th>
                        <th x-show="columns.client_ip" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Client IP</th>
                        <th x-show="columns.method" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Method</th>
                        <th x-show="columns.uri" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">URI</th>
                        <th x-show="columns.status" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Status</th>
                        <th x-show="columns.size" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Size</th>
                        <th x-show="columns.duration" scope="col" class="whitespace-nowrap border-b px-4 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-50">Duration</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
                    {% for log in json_logs %}
                    <tr x-show="searchQuery === '' || '{{ log.ts }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.level }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.logger }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.msg }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.request.client_ip }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.request.method }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.request.uri }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.status }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.size }}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ log.duration }}'.toLowerCase().includes(searchQuery.toLowerCase())" class="domain_row sm:[&_td:last-child]:pr-6 sm:[&_td:first-child]:pl-6 hover:bg-white dark:hover:bg-gray-900">
                        <td x-show="columns.timestamp" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400 timestamp" data-ts="{{ log.ts }}">{{ log.ts }}</td>
                        <td x-show="columns.level" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.level }}</td>
                        <td x-show="columns.logger" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.logger }}</td>
                        <td x-show="columns.message" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.msg }}</td>
                        <td x-show="columns.client_ip" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.request.client_ip }}</td>
                        <td x-show="columns.method" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.request.method }}</td>
                        <td x-show="columns.uri" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400"><a href="http://{{ domain_name}}{{ log.request.uri }}" target="_blank" class="hover:underline">{{ log.request.uri }}</a></td>
                        <td x-show="columns.status" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">
                            {% set status_str = log.status | string %}
                            {% if status_str.startswith('1') %}
                            <span class="bg-purple-100 text-purple-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-purple-900 dark:text-purple-300">{{ log.status }}</span>
                            {% elif status_str.startswith('2') %}
                            <span class="bg-green-100 text-green-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-green-900 dark:text-green-300">{{ log.status }}</span>
                            {% elif status_str.startswith('3') %}
                            <span class="bg-yellow-100 text-yellow-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-yellow-900 dark:text-yellow-300">{{ log.status }}</span>
                            {% elif status_str.startswith('4') %}
                            <span class="bg-red-100 text-red-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-red-900 dark:text-red-300">{{ log.status }}</span>
                            {% elif status_str.startswith('5') %}
                            <span class="bg-blue-100 text-blue-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-blue-900 dark:text-blue-300">{{ log.status }}</span>
                            {% else %}
                            <span class="bg-gray-100 text-gray-800 text-sm font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-gray-700 dark:text-gray-300">{{ log.status }}</span>
                            {% endif %}
                        </td>
                        <td x-show="columns.size" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.size }}</td>
                        <td x-show="columns.duration" class="whitespace-nowrap p-4 text-sm text-gray-600 dark:text-gray-400">{{ log.duration }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>



<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get all table cells with class 'timestamp'
        const timestampElements = document.querySelectorAll('.timestamp');
        
        timestampElements.forEach(function(element) {
            // Get the timestamp from the data attribute (it should be in seconds)
            const timestamp = parseFloat(element.getAttribute('data-ts'));

            // Ensure the timestamp is valid and convert to milliseconds
            if (!isNaN(timestamp)) {
                // Convert the timestamp from seconds to milliseconds
                const date = new Date(timestamp * 1000);  // Multiply by 1000 to convert to milliseconds

                // Check if the conversion resulted in a valid date
                if (!isNaN(date.getTime())) {
                    // Format the date to a human-readable format (YYYY-MM-DD HH:MM:SS)
                    const formattedDate = date.toISOString().slice(0, 19).replace('T', ' ');

                    // Update the element with the formatted date
                    element.innerText = formattedDate;
                } else {
                    element.innerText = 'Invalid Date';
                }
            } else {
                element.innerText = 'Invalid Timestamp';
            }
        });
    });
</script>


<!-- pagination -->
<div class="m-6 flex justify-center">
    <nav aria-label="Pagination">
        <ul class="inline-flex -space-x-px text-sm">
            {% if current_page > 1 %}
                <li>
                    <a href="{{ url_for('view_domain_access_log', domain_name=domain_name, page=current_page-1) }}" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700">Previous</a>
                </li>
            {% endif %}

            {% set window = 2 %}
            {% set start = 1 if current_page - window < 1 else current_page - window %}
            {% set end = total_pages if current_page + window > total_pages else current_page + window %}

            {% if start > 1 %}
                <li>
                    <a href="{{ url_for('view_domain_access_log', domain_name=domain_name, page=1) }}" class="px-3 py-2 leading-tight text-gray-500 border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 {% if current_page == 1 %} bg-gray-200 dark:bg-gray-700 {% endif %}">1</a>
                </li>
                {% if start > 2 %}
                    <li><span class="px-3 py-2 text-gray-500 dark:text-gray-400">…</span></li>
                {% endif %}
            {% endif %}

            {% for p in range(start, end + 1) %}
                <li>
                    <a href="{{ url_for('view_domain_access_log', domain_name=domain_name, page=p) }}" class="px-3 py-2 leading-tight text-gray-500 border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 {% if p == current_page %} bg-gray-200 dark:bg-gray-700 {% endif %}">{{ p }}</a>
                </li>
            {% endfor %}

            {% if end < total_pages %}
                {% if end < total_pages - 1 %}
                    <li><span class="px-3 py-2 text-gray-500 dark:text-gray-400">…</span></li>
                {% endif %}
                <li>
                    <a href="{{ url_for('view_domain_access_log', domain_name=domain_name, page=total_pages) }}" class="px-3 py-2 leading-tight text-gray-500 border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 {% if current_page == total_pages %} bg-gray-200 dark:bg-gray-700 {% endif %}">{{ total_pages }}</a>
                </li>
            {% endif %}

            {% if current_page < total_pages %}
                <li>
                    <a href="{{ url_for('view_domain_access_log', domain_name=domain_name, page=current_page+1) }}" class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700">Next</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
<!-- END pagination -->



{% else %}

<!-- page header -->
<section
    aria-label="Select Domain Log Header"
>


    <div x-data="{ showSection: false }" class="border-b border-gray-200 bg-gray-50 p-4 dark:border-gray-800 dark:bg-gray-950 sm:p-6 lg:p-8">
        <header>
            <div class="flex flex-col gap-2 text-center sm:flex-row sm:items-center sm:justify-between sm:text-start">
                <div class="grow">
                    <h1 class="mb-1 text-xl font-bold">Domain Logs</h1>
                    <h2 class="text-sm font-medium text-slate-500">View webserver raw access logs for domains.</h2>
                </div>
                <div class="flex flex-none items-center justify-center gap-2 rounded-sm px-2 sm:justify-end sm:bg-transparent sm:px-0">
                </div>
            </div>
        </header>
    </div>
<!-- END page header -->



<!-- form -->
<div class="sm:mx-auto sm:max-w-2xl p-6 m-6 CrawlerStatusCard" id="toAddActive">
    <form class="mt-8" method="GET">
        <div class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-6">


            <div class="col-span-full">


  <select id="domains" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" name="version" onchange="redirectToSelectedVersion(this)">
                          <option value="" disabled selected>Select domain</option> 
                      {% for domain in domains %}
                          <option value="{{ domain.domain_url }}">{{ domain.domain_url }}</option>
                      {% endfor %}
                      </select>
              <script>
                  // JavaScript function to redirect to the same page with domain parameter
                  function redirectToSelectedVersion(selectElement) {
                      var selectedVersion = selectElement.value;
                      if (selectedVersion) {
                          var url = `/domains/log/${selectedVersion}`;
                          window.open(url, '_self');
                      }
                  }
              </script>

    </form>
</div>

</section>
{% endif %}
{% endblock %}
