{% extends 'base.html' %}

{% block content %}

<div x-data="{ searchQuery: '', init() {
      const params = new URLSearchParams(window.location.search);
      const owner = params.get('owner');
      if (owner) this.searchQuery = owner;
    }
  }" x-init="init()">
    <div x-data="{ showSection: false }" class="border-b border-gray-200 bg-gray-50 p-4 dark:border-gray-800 dark:bg-gray-950 sm:p-6 lg:p-8">
        <header>
            <div class="flex flex-col gap-2 text-center sm:flex-row sm:items-center sm:justify-between sm:text-start">
                <div class="grow">
                    <h1 class="mb-1 text-xl font-bold">Domains</h1>
                    <h2 class="text-sm font-medium text-slate-500">All domains hosted on this OpenPanel server.</h2>
                </div>
                <div class="flex flex-none items-center justify-center gap-2 rounded-sm px-2 sm:justify-end sm:bg-transparent sm:px-0">
                </div>
            </div>
        </header>
    </div>



    <div class="">
        <div class="space-y-3">
            <div class="flex px-6 pt-3 flex-wrap items-center justify-between gap-2 sm:gap-x-6">
                <div class="flex w-full flex-col gap-2 sm:w-fit sm:flex-row sm:items-center">

                    <div class="relative w-full sm:max-w-[250px] sm:[&amp;>input]:h-[30px]">
    <input x-model="searchQuery"  class="relative block w-full appearance-none rounded-md border px-2.5 py-1.5 outline-none transition sm:text-sm border-transparent dark:border-gray-800 text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 bg-gray-100 dark:bg-gray-950 disabled:border-gray-300 disabled:bg-gray-100 disabled:text-gray-400 disabled:dark:border-gray-700 disabled:dark:bg-gray-800 disabled:dark:text-gray-500 focus:ring-2 focus:ring-indigo-200 focus:dark:ring-indigo-700/30 focus:border-indigo-500 focus:dark:border-indigo-700 [&amp;::--webkit-search-cancel-button]:hidden [&amp;::-webkit-search-cancel-button]:hidden [&amp;::-webkit-search-decoration]:hidden pl-8" placeholder="Search by user/domain..." type="search" @input="searchQuery">

                        <div class="pointer-events-none absolute bottom-0 left-2 flex h-full items-center justify-center text-gray-400 dark:text-gray-600">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-[1.125rem] shrink-0">
                                <path
                                    d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"
                                ></path>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="hidden flex items-center gap-2">
                </div>
            </div>

            <div class="relative" id="domains">
                <table class="w-full caption-bottom border-b border-gray-200 dark:border-gray-800" id="exiting_users">
                    <thead class="">
                        <tr class="[&amp;_td:last-child]:pr-4 [&amp;_th:last-child]:pr-4 [&amp;_td:first-child]:pl-4 [&amp;_th:first-child]:pl-4 border-y border-gray-200 dark:border-gray-800">
                <th class="hidden border-b px-4 text-left font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs">
                                <button
                                    type="button"
                                    role="checkbox"
                                    aria-checked="false"
                                    data-state="unchecked"
                                    value="on"
                                    aria-label="Select all"
                                    class="relative inline-flex size-4 shrink-0 appearance-none items-center justify-center rounded shadow-sm ring-1 ring-inset transition duration-100 enabled:cursor-pointer text-white dark:text-gray-50 bg-white dark:bg-gray-950 ring-gray-300 dark:ring-gray-800 data-[disabled]:bg-gray-100 data-[disabled]:text-gray-400 data-[disabled]:ring-gray-300 data-[disabled]:dark:bg-gray-800 data-[disabled]:dark:text-gray-500 data-[disabled]:dark:ring-gray-700 enabled:data-[state=checked]:bg-indigo-600 enabled:data-[state=checked]:ring-0 enabled:data-[state=checked]:ring-transparent enabled:data-[state=indeterminate]:bg-indigo-600 enabled:data-[state=indeterminate]:ring-0 enabled:data-[state=indeterminate]:ring-transparent outline outline-offset-2 outline-0 focus-visible:outline-2 outline-indigo-500 dark:outline-indigo-500 translate-y-0.5"
                                ></button>
                            </th>
                            <th class="hidden border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="">ID</div></th>
                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="-mx-2 inline-flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-1 hover:bg-gray-50 hover:dark:bg-gray-900"><span>Domain</span><div class="-space-y-2"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg></div></div></th>                            

                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="-mx-2 inline-flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-1 hover:bg-gray-50 hover:dark:bg-gray-900"><span>Status</span><div class="-space-y-2"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg></div></div></th>


                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="-mx-2 inline-flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-1 hover:bg-gray-50 hover:dark:bg-gray-900"><span>PHP version</span><div class="-space-y-2"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg></div></div></th>


                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="-mx-2 inline-flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-1 hover:bg-gray-50 hover:dark:bg-gray-900"><span>SSL</span><div class="-space-y-2"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg></div></div></th>

                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="-mx-2 inline-flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-1 hover:bg-gray-50 hover:dark:bg-gray-900"><span>WAF</span><div class="-space-y-2"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg></div></div></th>


                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="">Editor</div></th>


                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-left"><div class="-mx-2 inline-flex cursor-pointer select-none items-center gap-2 rounded-md px-2 py-1 hover:bg-gray-50 hover:dark:bg-gray-900"><span>Owner</span><div class="-space-y-2"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 10.8284L7.0502 15.7782L5.63599 14.364L11.9999 8L18.3639 14.364L16.9497 15.7782L11.9999 10.8284Z"></path></svg><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" aria-hidden="true" class="remixicon size-3.5 text-gray-900 dark:text-gray-50"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path></svg></div></div></th>



                            <th class="border-b px-4 font-semibold text-gray-900 dark:text-gray-50 border-gray-200 dark:border-gray-800 whitespace-nowrap py-1 text-sm sm:text-xs text-right"><div class="">Analytics</div></th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
                        
{% if domains %}

                        {% for domain in domains %}
                        <tr data-domain="{{ domain.domain_url }}" x-show="searchQuery === '' || '{{domain.domain_url}}'.toLowerCase().includes(searchQuery.toLowerCase()) || '{{ domain.username.split('_')[-1] }}'.toLowerCase().includes(searchQuery.toLowerCase())" class="[&_td:last-child]:pr-4 [&_th:last-child]:pr-4 [&_td:first-child]:pl-4 [&_th:first-child]:pl-4 group select-none hover:bg-gray-50 hover:dark:bg-gray-900 {% if 'SUSPENDED_' in domain.username %}suspended-user-row{% endif %}">

                        <td class="hidden p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left">{{ domain.domain_id }}</td>
                        <td class="p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left"><a href="http://{{ domain.domain_url }}" class="domain_name_in_table" target="_blank">{{ domain.domain_url }}</a></td>

           <td class="p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left sort-status">
            <span class="domain-status"><div class="placeholder placeholder-xs col-6"></div></span>
            </td>

<td class="p-4 text-sm relative whitespace-nowrap py-1 text-gray-600 first:w-10 dark:text-gray-400 text-left">
    
                                {% if domain.php_version in php_versions_data %}

                                {% if php_versions_data[domain.php_version]['isLatestVersion'] == True or php_versions_data[domain.php_version]['isFutureVersion'] == True or php_versions_data[domain.php_version]['isNextVersion'] == True %}
                                <div>
                                    <dd class="flex items-center gap-2">
                                        <div class="flex gap-0.5">
                                            <div class="h-3.5 w-1 rounded-sm bg-emerald-500 dark:bg-emerald-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-emerald-500 dark:bg-emerald-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-emerald-500 dark:bg-emerald-500"></div>
                                        </div>
                                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">{{ domain.php_version }}</p>
                                    </dd>
                                </div>
                                    {% elif php_versions_data[domain.php_version]['isSecureVersion'] == True %}

                                <div>
                                    <dd class="flex items-center gap-2">
                                        <div class="flex gap-0.5">
                                            <div class="h-3.5 w-1 rounded-sm bg-orange-500 dark:bg-orange-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-orange-500 dark:bg-orange-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-gray-500 dark:bg-gray-500"></div>
                                        </div>
                                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">{{ domain.php_version }}</p>
                                    </dd>
                                </div>
                                    {% else %}
                                <div>
                                    <dd class="flex items-center gap-2">
                                        <div class="flex gap-0.5">
                                            <div class="h-3.5 w-1 rounded-sm bg-red-500 dark:bg-red-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-gray-500 dark:bg-gray-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-gray-500 dark:bg-gray-500"></div>
                                        </div>
                                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">{{ domain.php_version }}</p>
                                    </dd>
                                </div>
                                  {% endif %}
                                {% else %}
                              <div>
                                    <dd class="flex items-center gap-2">
                                        <div class="flex gap-0.5">
                                            <div class="h-3.5 w-1 rounded-sm bg-gray-500 dark:bg-gray-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-gray-500 dark:bg-gray-500"></div>
                                            <div class="h-3.5 w-1 rounded-sm bg-gray-500 dark:bg-gray-500"></div>
                                        </div>
                                        <p class="text-sm font-semibold text-gray-900 dark:text-gray-50">{{ domain.php_version }}</p>
                                    </dd>
                                </div>
                                {% endif %}
    </td>



 
            <td class="p-4 text-sm relative whitespace-nowrap py-1 text-gray-600 first:w-10 dark:text-gray-400 text-left sort-ssl">
            <span class="domain-ssl flex"><div class="placeholder placeholder-xs col-6"></div></span>
            </td>


           <td class="p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left sort-coraza">
            <span class="domain-coraza"><div class="placeholder placeholder-xs col-6"></div></span>
            </td>


                        <td class="flex space-x-2  p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left">
                                <a href="/domains/dns/{{ domain.domain_url }}" target="_blank" class="flex btn">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path><path d="M16 5l3 3"></path></svg> DNS</a>

<a href="/domains/vhost/{{ domain.username }}/{{ domain.domain_url }}" target="_blank" class="flex btn">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path><path d="M16 5l3 3"></path></svg> VHost</a>


<a href="/domains/caddy/{{ domain.domain_url }}" target="_blank" class="flex btn">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path><path d="M16 5l3 3"></path></svg> Caddyfile</a></td>

                        <td class="p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left sort-username"><a href="/users/{{ domain.username }}">{{ domain.username.split('_')[-1] }} {% if "SUSPENDED_" in domain.username %}<span class="badge bg-red-lt">SUSPENDED</span>{% endif %}
</a></td>


                        <td class="flex space-x-2 p-4 text-sm relative whitespace-nowrap py-1 text-gray-600 first:w-10 dark:text-gray-400 text-right justify-end"><a href="/domains/log/{{ domain.domain_url }}" class="flex"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-zoom-code" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /><path d="M8 8l-2 2l2 2" /><path d="M12 8l2 2l-2 2" /></svg> Logs</a> <a href="/domains/stats/{{ domain.username.split('_')[-1] }}/{{ domain.domain_url }}" target="_blank" class="flex"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-world-www"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 7a9 9 0 0 0 -7.5 -4a8.991 8.991 0 0 0 -7.484 4" /><path d="M11.5 3a16.989 16.989 0 0 0 -1.826 4" /><path d="M12.5 3a16.989 16.989 0 0 1 1.828 4" /><path d="M19.5 17a9 9 0 0 1 -7.5 4a8.991 8.991 0 0 1 -7.484 -4" /><path d="M11.5 21a16.989 16.989 0 0 1 -1.826 -4" /><path d="M12.5 21a16.989 16.989 0 0 0 1.828 -4" /><path d="M2 10l1 4l1.5 -4l1.5 4l1 -4" /><path d="M17 10l1 4l1.5 -4l1.5 4l1 -4" /><path d="M9.5 10l1 4l1.5 -4l1.5 4l1 -4" /></svg> GoAccess</a></td>
                        <td class="p-4 text-sm relative whitespace-nowrap py-1 font-medium text-gray-900 dark:text-gray-50 first:w-10 text-left hidden"><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" aria-label="Transfer {{ domain.domain_url }} to another user" data-bs-original-title="Transfer {{ domain.domain_url }} to another user" class="btn btn-outline-primary" data-domain="{{ domain.domain_url }}"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-shuffle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 4l3 3l-3 3" /><path d="M18 20l3 -3l-3 -3" /><path d="M3 7h3a5 5 0 0 1 5 5a5 5 0 0 0 5 5h5" /><path d="M21 7h-5a4.978 4.978 0 0 0 -3 1m-4 8a4.984 4.984 0 0 1 -3 1h-3" /></svg> Transfer</a> <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" aria-label="Remove {{ domain.domain_url }} from user {{ domain.username }}" data-bs-original-title="Remove {{ domain.domain_url }} from user {{ domain.username }}" class="btn btn-outline-danger" data-domain="{{ domain.domain_url }}"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-trash"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0" /><path d="M10 11l0 6" /><path d="M14 11l0 6" /><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" /><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" /></svg> Remove</a></td>
                        </tr>
                        {% endfor %}







<script>
document.addEventListener("DOMContentLoaded", function () {
    // Iterate over each domain row
    document.querySelectorAll("tr[data-domain]").forEach(function (row) {
        const domain = row.querySelector(".domain_name_in_table").textContent.trim();

const statusCell = row.querySelector(".sort-status");
if (!statusCell) {
    console.error("Status cell not found for row:", row);
    return; // Skip this row and continue
}

const suspensionStatusSpan = statusCell.querySelector(".domain-status");
if (!suspensionStatusSpan) {
    console.error("Suspension status span not found for row:", row);
    return; // Skip this row and continue
}

const corazaStatusSpan = row.querySelector(".domain-coraza");
if (!corazaStatusSpan) {
    console.error("Coraza status span not found for row:", row);
    return; // Skip this row and continue
}

const sslCell = row.querySelector(".sort-ssl");
if (!sslCell) {
    console.error("SSL cell not found for row:", row);
    return; // Skip this row and continue
}

const sslStatusSpan = sslCell.querySelector(".domain-ssl");
if (!sslStatusSpan) {
    console.error("SSL status span not found for row:", row);
    return; // Skip this row and continue
}

        // Fetch domain status
        fetch(`/domains/${domain}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {


                if (data.coraza === "on") {
                    corazaStatusSpan.textContent = `Enabled`;
                } else if (data.coraza === "off") {
                    corazaStatusSpan.textContent = `Disabled`;
                } else {
                    corazaStatusSpan.textContent = `Unknown`;
                }



                if (data.status === "active") {
                    suspensionStatusSpan.innerHTML = `<span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-emerald-50 text-emerald-800 ring-emerald-600/30 dark:bg-emerald-400/10 dark:text-emerald-400 dark:ring-emerald-400/20">Active</span>`;
                } else if (data.status === "suspended") {
                    suspensionStatusSpan.innerHTML = `<span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-yellow-50 text-yellow-800 ring-yellow-600/30 dark:bg-yellow-400/10 dark:text-yellow-500 dark:ring-yellow-400/20">Suspended</span>`;
                } else {
                    suspensionStatusSpan.innerHTML = `<span class="inline-flex items-center gap-x-1 whitespace-nowrap rounded px-1.5 py-0.5 text-xs font-semibold ring-1 bg-gray-50 text-gray-800 ring-gray-600/30 dark:bg-gray-400/10 dark:text-gray-500 dark:ring-gray-400/20">Unknown</span>`;
                }

                if (data.ssl === "automatic") {
                    sslStatusSpan.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-lock-check">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M11.5 21h-4.5a2 2 0 0 1 -2 -2v-6a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v.5"/>
                            <path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0"/>
                            <path d="M8 11v-4a4 4 0 1 1 8 0v4"/>
                            <path d="M15 19l2 2l4 -4"/>
                        </svg> Automatic TLS`;
                } else if (data.ssl === "custom") {
                    sslStatusSpan.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-lock-check">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M11.5 21h-4.5a2 2 0 0 1 -2 -2v-6a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v.5"/>
                            <path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0"/>
                            <path d="M8 11v-4a4 4 0 1 1 8 0v4"/>
                            <path d="M15 19l2 2l4 -4"/>
                        </svg> Custom SSL`;
                } else {
                    sslStatusSpan.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-lock-open">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M5 11m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"/>
                            <path d="M12 16m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
                            <path d="M8 11v-5a4 4 0 0 1 8 0"/>
                        </svg> No SSL`;
                }
            })
            .catch(error => {
                console.error("Error fetching domain data:", error);
                suspensionStatusSpan.textContent = "Error";
                //corazaStatusSpan.textContent = "Error";
                sslStatusSpan.textContent =  "Error";
            });
    });
});
</script>




{% elif mysql_is_down %}
<tr>
    <td colspan="10" class="p-6 text-center">
        MySQL service is not running. 
    </td>
</tr>
{% else %}
<tr>
    <td colspan="10" class="p-6 text-center">
        No domains yet.
    </td>
</tr>
{% endif %}


                    </tbody>
                </table>

                <div class="fixed inset-x-0 bottom-8 mx-auto flex w-fit items-center"></div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
