{% extends 'base.html' %} {% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
<style>
    .active-status {
        color: green
    }

    .inactive-status {
        color: red !important;
        font-weight: 700
    }

    .other-status {
        color: orange !important
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>



<script src="https://preview.tabler.io/libs/apexcharts/dist/apexcharts.min.js?1740838750"></script>














<div class="row g-3 mb-0">


   {% if get_started %}
    <!-- Include the get_started.html template -->
        {% include 'dashboard/get_started.html' %}
    {% endif %}

 
 
    {% if server_data %}
    <!-- Include the custom_message.html template -->
        {% include 'dashboard/server_data.html' %}
    {% endif %}






        <div class="col-md-4 g-3">
            <div class="col-12">
                <div class="card" style="height:28rem">
                <div class="card-header">
                    <div>
                    <h6 class="card-title">Resources</h6>
                    <p class="card-subtitle">Current resources usage by the server.</p>
                    </div>
                    <nav class="nav nav-icon nav-icon-sm ms-auto"><a data-bs-toggle="collapse" class="nav-link collapsed" href="#resources_info" role="button" aria-expanded="false" aria-controls="resources_info"><i class="bi bi-question-circle"></i></a></nav>
                </div>

                <div class="card-header">
                    <ul class="nav nav-pills card-header-tabs nav-fill" data-bs-toggle="tabs">
                      <li class="nav-item">
                        <a href="#tabs-load" class="nav-link active" data-bs-toggle="tab"><i class="bi bi-bar-chart-fill px-2"></i> <span class="load1min" id="loadIconColor">Load</span></a>
                      </li>
                      <li class="nav-item">
                        <a href="#tabs-ram" class="nav-link" data-bs-toggle="tab"><i class="bi bi-memory px-2"></i> <span class="ram_usage" id="ramIconColor">RAM</span>
                        
                        
                        
                        
                        </a>
                      </li>
                      <li class="nav-item">
                        <a href="#tabs-cpu" class="nav-link" data-bs-toggle="tab"><i class="bi bi-cpu px-2"></i>
                        
                        <span class="" id="cpu_avg-now">CPU</span>
                        </a>
                      </li>
                      <li class="nav-item">
                        <a href="#tabs-disk" class="nav-link" data-bs-toggle="tab"><i class="bi bi-hdd-fill px-2"></i> <span class="home_usage" id="serverduIndicator">Disk</span></a>
                      </li>
                    </ul>
                </div>
                    <div class="card-body card-body-scrollable card-body-scrollable-shadow pt-1 pb-0">
                    <div class="collapse p-2" id="resources_info" style="">
                        <p>Real-time average load, CPU%, RAM% and Disk usage on the server.</p>
                    </div>



                        <div class="divide-y">
<div class="tab-content">
                      <div class="tab-pane active show" id="tabs-load">
                        <a href="{{ url_for('server_cpu_usage') }}" style="text-decoration:none;">
                                <div>
                                    <div class="d-flex align-items-center">
                                    <div class="subheader">Load Averages</div>
                                    <div class="ms-auto lh-1">
                                            <div class="dropdown">
                                            <a class="dropdown-toggle text-secondary" href="javascript:void(0)" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</a>
                                            <div class="dropdown-menu dropdown-menu-end" style="">
                                                <a class="dropdown-item" href="{{ url_for('server_cpu_usage') }}"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-list-details"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 5h8" /><path d="M13 9h5" /><path d="M13 15h8" /><path d="M13 19h5" /><path d="M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /><path d="M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /></svg>&nbsp; View Processes</a>
                                            </div>
                                            </div>
                                    </div>
                                    </div>
                                    <div class="d-flex align-items-baseline">
                                    <div class="me-auto">
                                                <div class="server-load">
                                                    <div class="h3 mb-3 me-2 load"><span class="load-indicator" id="load-indicator"></span>&nbsp;<b><span class="load1min">...</span>&nbsp;<span id="load5min">...</span>&nbsp;<span id="load15min">...</span></b></div>
                                                </div>
                                    </div>
                                    </div>
                                    <div id="chart-load" class="chart"></div>
                                </div>
                        </a>
                      </div>



                      <div class="tab-pane" id="tabs-cpu">


                                <div id="cpu_per_core_usage">
                                    <div class="d-flex align-items-center">
                                    <div class="subheader">CPU Usage</div>
                                    <div class="ms-auto lh-1">
                                            <div class="dropdown">
                                            <a class="dropdown-toggle text-secondary" href="javascript:void(0)" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</a>
                                            <div class="dropdown-menu dropdown-menu-end" style="">
                                                <a class="dropdown-item" href="{{ url_for('server_cpu_usage') }}"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-list-details"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 5h8" /><path d="M13 9h5" /><path d="M13 15h8" /><path d="M13 19h5" /><path d="M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /><path d="M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /></svg>&nbsp; View Processes</a>
                                            </div>
                                            </div>
                                    </div>
                                    </div>
                                    <div class="d-flex align-items-baseline">
                                    <div class="me-auto">
                                                <div class="">
                                                    <div class="h3 mb-3 me-2 load"><span id="cpu_total">...</span></b></div>
                                                </div>
                                    </div>
                                    </div>
  
  




                    <div class="main2">
                        <a href="{{ url_for('server_cpu_usage') }}">
                            <div class="container2"></div>

                        </a>
                    </div>

<script>
    $(document).ready(function() {
        function fetchData() {
            $.ajax({
                url: '/json/cpu-usage',
                type: 'GET',
                dataType: 'json',
                async: true,
                success: function(data) {
                    var container = $('.container2');
                    container.empty();

                    var totalUsage = 0;
                    var coreCount = 0;

                    $.each(data, function(core, usage) {
                        totalUsage += usage;
                        coreCount++;

                        var coreInfo = '<div><span>' + usage.toFixed(1) + '%</span></div>';
                        var coreDiv = $(coreInfo);

                        if (usage >= 90) {
                            coreDiv.css('background-color', 'crimson');
                        } else if (usage >= 80) {
                            coreDiv.css('background-color', 'antiquewhite');
                        }

                        container.append(coreDiv);
                    });

                    var avgUsage = coreCount > 0 ? (totalUsage / coreCount).toFixed(1) : 0;

                    $('#cpu_avg-now').removeClass("bg-primary-lt bg-danger-lt bg-warning-lt bg-success-lt");

                    if (avgUsage >= 90) {
                        $('#cpu_avg-now').addClass("bg-danger-lt");
                    } else if (avgUsage >= 80) {
                        $('#cpu_avg-now').addClass("bg-warning-lt");
                    } else if (avgUsage >= 50) {
                        $('#cpu_avg-now').addClass("bg-success-lt");
                    } else {
                        $('#cpu_avg-now').addClass("bg-primary-lt"); // Default class
                    }

                    $('#cpu_avg-now').text(avgUsage + '%');
                    $('#cpu_total').text(avgUsage + '%');
                },
                error: function() {
                    // Handle any errors here
                    console.log('Error fetching CPU usage data.');
                }
            });
        }

        fetchData();
        setInterval(fetchData, 1000);
    });
</script>

                   <style>
                        .main2 {
                            display: flex;
                            --s: 50px;
                            --m: 2px;
                            --f: calc(1.732 * var(--s) + 4 * var(--m) - 1px)
                        }

                        .container2 {
                            font-size: 0;
                            margin-bottom: 2rem
                        }

                        .container2 div {
                            position: relative;
                            width: var(--s);
                            margin: var(--m);
                            height: calc(var(--s)*1.1547);
                            display: inline-block;
                            font-size: initial;
                            clip-path: polygon(0 25%, 0 75%, 50% 100%, 100% 75%, 100% 25%, 50% 0);
                            background: #f0f8ff;
                            margin-bottom: calc(var(--m) - var(--s)*.2885)
                        }

                        .container2 div span {
                            vertical-align: middle;
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            font-size: 12px;
                            font-weight: 700;
                            color: #000
                        }

                        .container2::before {
                            content: "";
                            width: calc(var(--s)/ 2 + var(--m));
                            float: left;
                            height: 120%;
                            shape-outside: repeating-linear-gradient(#0000 0 calc(var(--f) - 3px), #000 0 var(--f))
                        }
                    </style>



                        </div>
                        
                        
                        </div>


                      <div class="tab-pane" id="tabs-ram">
                                           <a href="{{ url_for('server_memory_usage') }}" style="text-decoration:none;">
                  <div>
                    <div class="d-flex align-items-center">
                      <div class="subheader">Memory Usage</div>
                      <div class="ms-auto lh-1">
                            <div class="dropdown">
                            <a class="dropdown-toggle text-secondary" href="javascript:void(0)" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</a>
                            <div class="dropdown-menu dropdown-menu-end" style="">
                                <a class="dropdown-item" href="/server/memory_usage"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-list-details"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 5h8" /><path d="M13 9h5" /><path d="M13 15h8" /><path d="M13 19h5" /><path d="M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /><path d="M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" /></svg>&nbsp; View Processes</a>

                    <a class="dropdown-item" href="javascript:void(0)" id="clear-cache"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rocket"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 13a8 8 0 0 1 7 7a6 6 0 0 0 3 -5a9 9 0 0 0 6 -8a3 3 0 0 0 -3 -3a9 9 0 0 0 -8 6a6 6 0 0 0 -5 3" /><path d="M7 14a6 6 0 0 0 -3 6a6 6 0 0 0 6 -3" /><path d="M15 9m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /></svg>&nbsp; Clear Cached RAM</a>

                                <a class="d-none dropdown-item" href="/services/resources"><svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-badge-sd"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z" /><path d="M14 9v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z" /><path d="M7 14.25c0 .414 .336 .75 .75 .75h1.25a1 1 0 0 0 1 -1v-1a1 1 0 0 0 -1 -1h-1a1 1 0 0 1 -1 -1v-1a1 1 0 0 1 1 -1h1.25a.75 .75 0 0 1 .75 .75" /></svg>&nbsp; Create SWAP</a>
                            </div>
                            </div>
                      </div>
                    </div>
                    <div class="d-flex align-items-baseline">
                      <div class="h3 mb-3 me-2 ram-info" id="human-readable-info"></div>
                      <div class="me-auto">
                        <span class="bg-primary-lt text-white d-inline-flex align-items-center lh-1"></span>
                      </div>
                    </div>
                    <div id="chart-ram" class="chart"></div>
                  </div>
                </a>   


    <script>
        $(document).ready(function() {
            $('#clear-cache').on('click', function(event) {
                event.preventDefault(); // Prevent the default behavior to keep the dropdown open
                var dropdownItem = $(this);

                $.ajax({
                    url: '/server/memory_usage/drop',
                    type: 'POST',
                    success: function(response) {
                        // Update only the "Clear Cached RAM" item
                        dropdownItem.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rocket"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 13a8 8 0 0 1 7 7a6 6 0 0 0 3 -5a9 9 0 0 0 6 -8a3 3 0 0 0 -3 -3a9 9 0 0 0 -8 6a6 6 0 0 0 -5 3" /><path d="M7 14a6 6 0 0 0 -3 6a6 6 0 0 0 6 -3" /><path d="M15 9m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /></svg>&nbsp;' + response.message);
                    },
                    error: function(xhr, status, error) {
                        // Handle error
                        dropdownItem.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rocket"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 13a8 8 0 0 1 7 7a6 6 0 0 0 3 -5a9 9 0 0 0 6 -8a3 3 0 0 0 -3 -3a9 9 0 0 0 -8 6a6 6 0 0 0 -5 3" /><path d="M7 14a6 6 0 0 0 -3 6a6 6 0 0 0 6 -3" /><path d="M15 9m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /></svg>&nbsp; Error: ' + xhr.responseJSON.message);
                    }
                });
            });
        });
    </script>
                      </div>

                      <div class="tab-pane" id="tabs-disk">
                            
                  <div class="">
                    <div class="d-flex align-items-center">
                      <div class="subheader">Disk Usage</div>
                      <div class="ms-auto lh-1">
                      </div>
                    </div>
                    <div class="h3 mb-3 me-2"><span id="total_gb_used"></span> <span class="home_usage">...</span></div>
                  </div>
                    <table id="disk-usage-table" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Partition</th>
                                <th>Storage Usage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td class="d-none">
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="progressbg">
                                        <div class="progress progressbg-progress">
                                            <div class="progress-bar bg-primary-lt" style="width:15.2%" role="progressbar" aria-valuenow="15.2" aria-valuemin="0" aria-valuemax="100" aria-label="15.2% Used"><span class="visually-hidden">15.2% Complete</span></div>
                                        </div>
                                        <div class="progressbg-text">/</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td class="">
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="progressbg">
                                        <div class="progress progressbg-progress">
                                            <div class="progress-bar bg-primary-lt" style="width:55.2%" role="progressbar" aria-valuenow="55.2" aria-valuemin="0" aria-valuemax="100" aria-label="15.2% Used"><span class="visually-hidden">15.2% Complete</span></div>
                                        </div>
                                        <div class="progressbg-text">/</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td class="">
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="progressbg">
                                        <div class="progress progressbg-progress">
                                            <div class="progress-bar bg-primary-lt" style="width:85.2%" role="progressbar" aria-valuenow="85.2" aria-valuemin="0" aria-valuemax="100" aria-label="15.2% Used"><span class="visually-hidden">15.2% Complete</span></div>
                                        </div>
                                        <div class="progressbg-text">/</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td class="">
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="progressbg">
                                        <div class="progress progressbg-progress">
                                            <div class="progress-bar bg-primary-lt" style="width:85.2%" role="progressbar" aria-valuenow="85.2" aria-valuemin="0" aria-valuemax="100" aria-label="15.2% Used"><span class="visually-hidden">15.2% Complete</span></div>
                                        </div>
                                        <div class="progressbg-text">/</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td class="">
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="placeholder col-9 mb-0"></div>
                                </td>
                                <td>
                                    <div class="progressbg">
                                        <div class="progress progressbg-progress">
                                            <div class="progress-bar bg-primary-lt" style="width:85.2%" role="progressbar" aria-valuenow="85.2" aria-valuemin="0" aria-valuemax="100" aria-label="15.2% Used"><span class="visually-hidden">15.2% Complete</span></div>
                                        </div>
                                        <div class="progressbg-text">/</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td>
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                                <td class="">
                                    <div class="placeholder placeholder-xs col-8"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                      </div>



</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-md-4 g-3">
            <div class="col-12">
                <div class="card" style="height:28rem">
                <div class="card-header">
                    <div>
                <h6 class="card-title">User Activity</h6>
                    <p class="card-subtitle">Real-time user activity log.</p>
                    </div>
                </div>
                    <div id="activity-table" class="card-body card-body-scrollable card-body-scrollable-shadow">
                        <div class="divide-y"><span id="shouldbehidden">Users activity log will appear here.</span></div>
                    </div>
                </div>
            </div>
        </div>




    
        <div class="col-md-4 g-3">
            <div class="card card-one" style="height:28rem">
                <div class="card-header">
                    <div>
                    <h6 class="card-title">Services Status</h6>
                    <p class="card-subtitle">The Service Status table only reports monitored services.</p>
                    </div>
                    <nav class="nav nav-icon nav-icon-sm ms-auto"><a data-bs-toggle="collapse" class="nav-link collapsed" href="#services_info" role="button" aria-expanded="false" aria-controls="services_info"><i class="bi bi-question-circle"></i></a></nav>
                </div>
                <div class="card-body" style="padding:0;align-content: space-between;display: grid;">
                    <div class="collapse p-2" id="services_info" style="">
                        <p>Display current status of all monitored system services and docker containers. To add custom services to the list, edit the <code>/etc/openpanel/openadmin/config/services.json</code> file.
                        </p>

                        <p>
                            <ul>
                                <li><span class="legend me-2 bg-success"></span><span>- is currently active and running.</span></li>
                                <li><span class="legend me-2 bg-danger"></span><span>- not currently active, either failed or stopped.</span></li>
                                <li><span class="legend me-2 bg-primary"></span><span>- not yet started, will auto-start when user/domains are created.</span></li>
                                <li><span class="legend me-2 bg-warning"></span><span>- there was a problem getting service status.</span></li>
                            </ul>
                        <p>

                    <!--p class="text-center text-secondary"><a href="/services/status">Edit Managed Services</a></p-->

                    </div>
                    <div id="service-table">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Loading;</td>
                                    <td><span class="badge bg-secondary me-1"></span>Checking</td>
                                    <td><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Restart service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5"></path><path d="M5.63 7.16l0 .01"></path><path d="M4.06 11l0 .01"></path><path d="M4.63 15.1l0 .01"></path><path d="M7.16 18.37l0 .01"></path><path d="M11 19.94l0 .01"></path></svg></a>
                                        <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop OpenPanel service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-stop" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"></path></svg></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Loading</td>
                                    <td><span class="badge bg-secondary me-1"></span>Checking</td>
                                    <td><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Restart service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5"></path><path d="M5.63 7.16l0 .01"></path><path d="M4.06 11l0 .01"></path><path d="M4.63 15.1l0 .01"></path><path d="M7.16 18.37l0 .01"></path><path d="M11 19.94l0 .01"></path></svg></a>
                                        <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop OpenPanel service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-stop" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"></path></svg></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Loading</td>
                                    <td><span class="badge bg-secondary me-1"></span>Checking</td>
                                    <td><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Restart service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5"></path><path d="M5.63 7.16l0 .01"></path><path d="M4.06 11l0 .01"></path><path d="M4.63 15.1l0 .01"></path><path d="M7.16 18.37l0 .01"></path><path d="M11 19.94l0 .01"></path></svg></a>
                                        <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop OpenPanel service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-stop" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"></path></svg></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Loading</td>
                                    <td><span class="badge bg-secondary me-1"></span>Checking</td>
                                    <td><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Restart service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5"></path><path d="M5.63 7.16l0 .01"></path><path d="M4.06 11l0 .01"></path><path d="M4.63 15.1l0 .01"></path><path d="M7.16 18.37l0 .01"></path><path d="M11 19.94l0 .01"></path></svg></a>
                                        <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop OpenPanel service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-stop" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"></path></svg></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Loading</td>
                                    <td><span class="badge bg-secondary me-1"></span>Checking</td>
                                    <td><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Restart service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5"></path><path d="M5.63 7.16l0 .01"></path><path d="M4.06 11l0 .01"></path><path d="M4.63 15.1l0 .01"></path><path d="M7.16 18.37l0 .01"></path><path d="M11 19.94l0 .01"></path></svg></a>
                                        <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop OpenPanel service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-stop" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"></path></svg></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Loading</td>
                                    <td><span class="badge bg-secondary me-1"></span>Checking</td>
                                    <td><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Restart service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rotate-clockwise-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 4.55a8 8 0 0 1 6 14.9m0 -4.45v5h5"></path><path d="M5.63 7.16l0 .01"></path><path d="M4.06 11l0 .01"></path><path d="M4.63 15.1l0 .01"></path><path d="M7.16 18.37l0 .01"></path><path d="M11 19.94l0 .01"></path></svg></a>
                                        <a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Stop OpenPanel service"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-player-stop" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"></path></svg></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>






        <div class="col-md-4 g-3">
            <div class="card card-one" style="height:28rem">
                <div class="card-header">
                    <div>
                    <h6 class="card-title">System Information</h6>
                    <p class="card-subtitle">Information about your server configuration.</p>
                    </div>

                    <nav class="nav nav-icon nav-icon-sm ms-auto"><a data-bs-toggle="collapse" class="nav-link collapsed" href="#system_info" role="button" aria-expanded="false" aria-controls="system_info"><i class="bi bi-question-circle"></i></a></nav>
                </div>
                <div class="card-body" style="padding:0">
                    <div class="collapse p-2" id="system_info" style="">
                        <p>Server hardware and OS information</p>
                    </div>
                    <div id="system-table">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <td>Hostname</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>OS</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>OpenPanel version</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Server Time</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0" id="server-time"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Kernel</td>
                                    <td class="text-secondary">
                                        <div class="placeholder mb-0"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>CPU</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Uptime</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Running Processes</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                                <tr style="display:none;">
                                    <td>Package Updates</td>
                                    <td class="text-secondary">
                                        <div class="placeholder col-12 mb-0"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>



    {% if license_type == "Community" %}
        {% if try_enterprise %}
            <!-- Include the try_enterprise.html template -->
            {% include 'dashboard/try_enterprise.html' %}
        {% endif %}
    {% endif %}


    {% if openpanel_news %}
    <!-- Include the custom_message.html template -->
        {% include 'dashboard/openpanel_news.html' %}
    {% endif %}


    </div>





<script src="{{ url_for('static', filename='pages/dashboard.js') }}" defer="defer"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/json/system')
            .then(response => response.json())
            .then(data => {
                let tableHtml = '<table class="table">';
                // Hostname
                tableHtml += `<tr><td>Hostname</td><td class="text-secondary">${data.hostname}</td></tr>`;
                // OS
                let osIcon = '';
                if (data.os.toLowerCase().includes('ubuntu')) {
                    osIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-ubuntu"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17.723 7.41a7.992 7.992 0 0 0 -3.74 -2.162m-3.971 0a7.993 7.993 0 0 0 -3.789 2.216m-1.881 3.215a8 8 0 0 0 -.342 2.32c0 .738 .1 1.453 .287 2.132m1.96 3.428a7.993 7.993 0 0 0 3.759 2.19m4 0a7.993 7.993 0 0 0 3.747 -2.186m1.962 -3.43a8.008 8.008 0 0 0 .287 -2.131c0 -.764 -.107 -1.503 -.307 -2.203" /><path d="M5 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M19 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /></svg>';
                } else if (data.os.toLowerCase().includes('debian')) {
                    osIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-debian"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M12 17c-2.397 -.943 -4 -3.153 -4 -5.635c0 -2.19 1.039 -3.14 1.604 -3.595c2.646 -2.133 6.396 -.27 6.396 3.23c0 2.5 -2.905 2.121 -3.5 1.5c-.595 -.621 -1 -1.5 -.5 -2.5" /><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /></svg>';
                } else if (data.os.toLowerCase().includes('coreos')) {
                    osIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-coreos"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M21 12a9 9 0 1 1 -18 0a9 9 0 0 1 18 0z" /><path d="M12 3c-3.263 3.212 -3 7.654 -3 12c4.59 .244 8.814 -.282 12 -3" /><path d="M9.5 9a4.494 4.494 0 0 1 5.5 5.5" /></svg>';
                }
                tableHtml += `<tr><td>OS</td><td class="text-secondary">${osIcon} ${data.os}</td></tr>`;
                
                // OpenPanel version
                tableHtml += `<tr id="openpanel_version_data"><td>OpenPanel version</td><td class="text-secondary"><a href="https://openpanel.com/docs/changelog/${data.openpanel_version}" target="_blank">${data.openpanel_version}</a></td></tr>`;
                // Time
                tableHtml += `<tr><td>Server Time</td><td class="text-secondary" id="server-time">${data.time}</td></tr>`;
                // Kernel
                tableHtml += `<tr><td>Kernel</td><td class="text-secondary">${data.kernel}</td></tr>`;
                // CPU with link
                let logoHtml = '';
                if (data.cpu.includes('QEMU')) {
                    logoHtml = `<span data-bs-toggle="tooltip" data-bs-placement="right" title="${data.cpu}"><img src="{{ url_for('static', filename='images/dashboard/qemu.png') }}" style="height:2em;" alt="QEMU Logo"></span>`;
                } else if (data.cpu.includes('Intel')) {
                    logoHtml = `<span data-bs-toggle="tooltip" data-bs-placement="right" title="${data.cpu}"><img src="{{ url_for('static', filename='images/dashboard/intel.png') }}" style="height:2em;" alt="Intel Logo"></span>`;
                } else if (data.cpu.includes('AMD')) {
                    logoHtml = `<span data-bs-toggle="tooltip" data-bs-placement="right" title="${data.cpu}"><img src="{{ url_for('static', filename='images/dashboard/amd.svg') }}" style="height:2em;" alt="AMD Logo"></span>`;
                } else if (data.cpu.includes('DO-')) {
                    logoHtml = `<span data-bs-toggle="tooltip" data-bs-placement="right" title="${data.cpu}"><img src="{{ url_for('static', filename='images/dashboard/do.png') }}" style="height:2em;" alt="DigitalOcean Logo"></span>`;
                } else if (data.cpu.includes('AWS')) {
                    logoHtml = `<span data-bs-toggle="tooltip" data-bs-placement="right" title="${data.cpu}"><img src="{{ url_for('static', filename='images/dashboard/aws.png') }}" style="height:2em;" alt="AWS Logo"></span>`;
                } else {
                    logoHtml = data.cpu; // for all others
                }
                tableHtml += `<tr><td>CPU</td><td class="text-secondary">${logoHtml}</td></tr>`;

                // Uptime
                let formattedUptime = formatUptime(data.uptime);
                tableHtml += `<tr><td>Uptime</td><td class="text-secondary">${formattedUptime}</td></tr>`;

                // Running Processes
                tableHtml += `<tr><td>Running Processes</td><td class="text-secondary"><a href="/server/cpu_usage">${data.running_processes}</a></td></tr>`;

                // Close the table tag
                tableHtml += `</table>`;
                document.getElementById('system-table').innerHTML = tableHtml;

                // Start the fake time counter
                startFakeTimeCounter(data.time);

                // Check for OpenPanel updates
                checkForUpdates(data.openpanel_version);
            })
            .catch(error => {
                console.error('Error fetching system info:', error);
                document.getElementById('system-table').innerText = 'Failed to load system information.';
            });
    });

    function formatUptime(seconds) {
        const minute = 60,
            hour = 3600,
            day = 86400,
            month = day * 30,
            year = day * 365;

        function pluralize(value, word) {
            return `${value} ${word}${value > 1 ? 's' : ''}`;
        }
        if (seconds < minute) return pluralize(seconds, 'second');
        else if (seconds < hour) return pluralize(Math.floor(seconds / minute), 'minute');
        else if (seconds < day) return `${pluralize(Math.floor(seconds / hour), 'hour')}, ${pluralize(Math.floor((seconds % hour) / minute), 'minute')}`;
        else if (seconds < month) return `${pluralize(Math.floor(seconds / day), 'day')}, ${pluralize(Math.floor((seconds % day) / hour), 'hour')}`;
        else if (seconds < year) return `${pluralize(Math.floor(seconds / month), 'month')}, ${pluralize(Math.floor((seconds % month) / day), 'day')}`;
        else return `${pluralize(Math.floor(seconds / year), 'year')}, ${pluralize(Math.floor((seconds % year) / month), 'month')}`;
    }

    function startFakeTimeCounter(startTime) {
        let startDate = new Date(startTime);
        setInterval(() => {
            startDate.setSeconds(startDate.getSeconds() + 1);
            document.getElementById('server-time').textContent = startDate.toLocaleString();
        }, 1000);
    }

function checkForUpdates(currentVersion) {
    fetch('https://raw.githubusercontent.com/stefanpejcic/OpenPanel/refs/heads/main/version/latest')
        .then(response => response.text())
        .then(latestVersion => {
            latestVersion = latestVersion.trim();

            // Function to compare semantic versioning
            function isNewerVersion(current, latest) {
                const currentParts = current.split('.').map(Number);
                const latestParts = latest.split('.').map(Number);

                for (let i = 0; i < Math.max(currentParts.length, latestParts.length); i++) {
                    const currentPart = currentParts[i] || 0;
                    const latestPart = latestParts[i] || 0;

                    if (currentPart < latestPart) return true;
                    if (currentPart > latestPart) return false;
                }
                return false;
            }

            if (isNewerVersion(currentVersion, latestVersion)) {
                const updatedRow = `
                <tr id="openpanel_version_data">
                    <td>OpenPanel version</td>
                    <td class="text-secondary">
                        <a href="https://openpanel.com/docs/changelog/${currentVersion.trim()}" data-bs-toggle="tooltip" data-bs-placement="top" title="View Changelog for OpenPanel version ${currentVersion.trim()}" target="_blank">${currentVersion.trim()}</a> <a href="/settings/general"><span class="badge bg-success">Update is available: ${latestVersion}</span></a>
                    </td>
                </tr>`;
                // Replace the existing row with the updated row
                document.getElementById('openpanel_version_data').outerHTML = updatedRow;
            }
        })
        .catch(error => console.error('Error checking for updates:', error));
}


</script>


<style>
  .nav {
    --tblr-nav-link-padding-x: 0;
    --tblr-nav-link-padding-y: 0;
  }
</style>

{% endblock %}
