<!-- START sse_tab.html -->


<style>
@media (max-width: 1200px) {
  .fixed-mobile {
    position: fixed;
  }
}
</style>

<div role="tablist" aria-orientation="horizontal" class="inline-flex items-center justify-center p-1 bg-gray-100 dark:bg-gray-900 rounded-md gap-1 fixed-mobile bottom-0 left-0 right-0 z-20 inline-flex items-center justify-center p-1 bg-gray-100 dark:bg-gray-900 rounded-t-md w-full sm:static sm:rounded-md sm:w-auto sm:justify-center border-t sm:border-0 border-gray-200 dark:border-gray-800" tabindex="0" data-orientation="horizontal">
    <a
        href="{% if not is_reseller %}/server/processes?sort=cpu{% else %}#{% endif %}"
        role="tab"
        class="inline-flex items-center justify-center whitespace-nowrap rounded px-3 py-1 text-sm font-medium ring-1 ring-inset transition-all text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:dark:text-gray-200 ring-transparent w-full cursor-pointer bg-white text-gray-900 shadow dark:bg-gray-950 dark:text-gray-50"
        data-tooltip-target="tooltip-sse_load" data-tooltip-placement="bottom"
    >
        <i class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart-fill" viewBox="0 0 16 16"><path d="M1 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm5-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1z"/>
</svg></i> <span id="sse_load" class=""></span>
    </a>


                                <div id="tooltip-sse_load" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">Loading..<div class="tooltip-arrow" data-popper-arrow></div>
                                </div>




    <a
        href="{% if not is_reseller %}/server/processes?sort=memory{% else %}#{% endif %}"
        role="tab"
        class="inline-flex items-center justify-center whitespace-nowrap rounded px-3 py-1 text-sm font-medium ring-1 ring-inset transition-all text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:dark:text-gray-200 ring-transparent w-full cursor-pointer bg-white text-gray-900 shadow dark:bg-gray-950 dark:text-gray-50"
        data-tooltip-target="tooltip-sse_cpu" data-tooltip-placement="bottom"

    >
        <i class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-memory" viewBox="0 0 16 16"> <path d="M1 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.586a1 1 0 0 0 .707-.293l.353-.353a.5.5 0 0 1 .708 0l.353.353a1 1 0 0 0 .707.293H15a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm.5 1h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5m5 0h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5m4.5.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zM2 10v2H1v-2zm2 0v2H3v-2zm2 0v2H5v-2zm3 0v2H8v-2zm2 0v2h-1v-2zm2 0v2h-1v-2zm2 0v2h-1v-2z"/> </svg></i> <span id="sse_memory" class=""></span>
    </a>

                                <div id="tooltip-sse_cpu" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">Loading..<div class="tooltip-arrow" data-popper-arrow></div>
                                </div>


    <a
        href="{% if not is_reseller %}/server/processes?sort=cpu{% else %}#{% endif %}"
        role="tab"
        class="inline-flex items-center justify-center whitespace-nowrap rounded px-3 py-1 text-sm font-medium ring-1 ring-inset transition-all text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:dark:text-gray-200 ring-transparent w-full cursor-pointer bg-white text-gray-900 shadow dark:bg-gray-950 dark:text-gray-50"
        data-tooltip-target="tooltip-sse_memory" data-tooltip-placement="bottom"

    >
        <i class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cpu" viewBox="0 0 16 16"> <path d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0m-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/> </svg></i> <span id="sse_cpu" class=""></span>
    </a>


                                <div id="tooltip-sse_memory" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">Loading..<div class="tooltip-arrow" data-popper-arrow></div>
                                </div>


    <button
        type="button"
        role="tab"
        class="inline-flex items-center justify-center whitespace-nowrap rounded px-3 py-1 text-sm font-medium ring-1 ring-inset transition-all text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:dark:text-gray-200 ring-transparent w-full cursor-pointer bg-white text-gray-900 shadow dark:bg-gray-950 dark:text-gray-50"
        data-tooltip-target="tooltip-sse_disk" data-tooltip-placement="bottom"

    >
        <i class="px-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hdd-fill" viewBox="0 0 16 16"> <path d="M0 10a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1m2 0a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M.91 7.204A3 3 0 0 1 2 7h12c.384 0 .752.072 1.09.204l-1.867-3.422A1.5 1.5 0 0 0 11.906 3H4.094a1.5 1.5 0 0 0-1.317.782z"/> </svg></i>  <span id="sse_disk" class=""></span>
    </button>


                                <div id="tooltip-sse_disk" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-gray-700">Loading..<div class="tooltip-arrow" data-popper-arrow></div>
                                </div>

</div>

<script>
const cachedData = JSON.parse(localStorage.getItem("sseData") || "{}");

function formatBytes(bytes) {
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
    if (bytes === 0) return '0 B';
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];
}

function updateSSEUI(data) {
    // CPU Average
    if (data.cpu !== undefined) {
        const cpuAvg = Object.values(data.cpu).reduce((a,b)=>a+b,0)/Object.values(data.cpu).length;
        document.getElementById("sse_cpu").textContent = cpuAvg.toFixed(1) + "%";

        const cpuTooltip = document.getElementById("tooltip-sse_cpu");
        cpuTooltip.innerHTML = "CPU Usage per core:<br>" + 
            Object.entries(data.cpu)
                  .map(([core, val]) => `${core.replace(/_/g, ' ')}: ${val.toFixed(1)}%`)
                  .join("<br>") +
            `<div class="tooltip-arrow" data-popper-arrow></div>`;
    }

    // Memory
    if (data.memory !== undefined) {
        const mem = data.memory.human_readable;
        document.getElementById("sse_memory").textContent = mem.ram.percent;

        const memTooltip = document.getElementById("tooltip-sse_memory");
        memTooltip.innerHTML = `
            RAM: ${mem.ram.used} / ${mem.ram.total} (${mem.ram.percent})<br>
            Swap: ${mem.swap.used} / ${mem.swap.total} (${mem.swap.percent})<br>
            <div class="tooltip-arrow" data-popper-arrow></div>
        `;
    }

    // Load
    if (data.load !== undefined) {
        document.getElementById("sse_load").textContent = data.load.load1min.toFixed(2);

        const loadTooltip = document.getElementById("tooltip-sse_load");
        loadTooltip.innerHTML = `
            Load 1 min: ${data.load.load1min.toFixed(2)}<br>
            Load 5 min: ${data.load.load5min.toFixed(2)}<br>
            Load 15 min: ${data.load.load15min.toFixed(2)}<br>
            <div class="tooltip-arrow" data-popper-arrow></div>
        `;
    }

    // Disk
    if (data.disk !== undefined) {
        const filteredDisks = data.disk.filter(d => !d.mountpoint.startsWith("/mnt"));

        const diskUsages = filteredDisks.map(d => d.percent).filter(p => p !== undefined);
        const diskAvg = diskUsages.reduce((a, b) => a + b, 0) / diskUsages.length;
        document.getElementById("sse_disk").textContent = diskAvg.toFixed(1) + "%";

        const diskTooltip = document.getElementById("tooltip-sse_disk");
        diskTooltip.innerHTML = filteredDisks.map(d => `
            ${d.device} mounted on ${d.mountpoint} (${d.fstype}):<br>
            Used: ${formatBytes(d.used)} / ${formatBytes(d.total)} (${d.percent}%)<br>
        `).join("<br>") + `<div class="tooltip-arrow" data-popper-arrow></div>`;
    }

}

// Initial load
if (Object.keys(cachedData).length) {
    updateSSEUI(cachedData);
}

// SSE listener
const evtSource = new EventSource("/sse/usage");
evtSource.onmessage = function(event) {
    const data = JSON.parse(event.data);
    updateSSEUI(data);
    localStorage.setItem("sseData", JSON.stringify(data));
};

evtSource.onerror = function(err) {
    console.error("SSE error:", err);
};
</script>



<!-- END sse tab -->
