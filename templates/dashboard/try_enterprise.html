<style>
    .dismiss-custom_message-button {
        display: none;
    }
    #custom_message:hover .dismiss-custom_message-button {
        display: inline-block;
    }
</style>

<div class="">
    <div id="custom_message" class="p-4">
        <div class="flex justify-between items-center border-b pb-3">
            <form action="{{ url_for('dismiss_dashboard_widget', template_name='try_enterprise') }}" method="post" class="w-full">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <h6 class="text-lg font-semibold flex items-center">
                    Try Enterprise 
                    <button class="dismiss-custom_message-button text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded px-2 py-1 ml-2" type="submit">Dismiss</button>
                </h6>
                <p class="text-sm text-gray-600" id="pricing-container"></p>
            </form>
            <a href="/license" id="purchaselink" class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm">Upgrade Now</a>
        </div>
        <div class="mt-4">
            <p class="text-gray-600 font-bold">OpenPanel Enterprise edition</p>
            <p class="text-gray-600">offers advanced features for user isolation and management, suitable for web hosting providers.</p>
            <div class="divide-y mt-4" id="features-container"></div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $.ajax({
        url: 'https://api.openpanel.com/whmcs.php',
        method: 'GET',
        dataType: 'json',
        success: function(response) {
            if (response.result === 'success' && response.totalresults > 0) {
                const product = response.products.product[0];
                const pricing = product.pricing.EUR;
                
                $('#pricing-container').html(`Starting at ${pricing.monthly} ${pricing.suffix} monthly`);
                $('#purchaselink').attr('href', product.product_url);
                
                const featureListMatch = product.description.match(/<ul>(.*?)<\/ul>/s);
                if (featureListMatch) {
                    const features = featureListMatch[1].match(/<li>(.*?)<\/li>/g).map(item => item.replace(/<li>|<\/li>/g, '').trim());
                    const featuresContainer = $('#features-container');
                    featuresContainer.empty();
                    
                    features.forEach(feature => {
                        featuresContainer.append(`
                            <div class="flex items-center gap-2 py-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12l5 5L20 7" />
                                </svg>
                                <span>${feature}</span>
                            </div>
                        `);
                    });
                } else {
                    $('#features-container').html('<p class="text-gray-500">No features found.</p>');
                }
            } else {
                $('#pricing-container').html('<p class="text-gray-500">No products found.</p>');
            }
        },
        error: function(xhr, status, error) {
            console.error('AJAX Error:', status, error);
            console.error('Response:', xhr.responseText);
            $('#pricing-container').html('<p class="text-red-500">Error retrieving pricing information.</p>');
        }
    });
});
</script>
